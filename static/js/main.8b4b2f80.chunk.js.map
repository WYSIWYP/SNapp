{"version":3,"sources":["contexts/Dialog.tsx","components/Frame.tsx","components/Expandable.tsx","contexts/CurrentFile.tsx","pages/Convert.tsx","pages/NotFound.tsx","contexts/Global.tsx","components/global/Dialog.tsx","components/global/Global.tsx","pages/Menu.tsx","Router.tsx","serviceWorker.ts","index.tsx","contexts/Preferences.tsx","util/Util.tsx","components/SNView.tsx","util/Dialog.tsx","images/upload.svg","parser/Types.tsx","parser/MusicXML.tsx"],"names":["initialState","shown","DialogContext","createContext","undefined","DialogStateProvider","children","reducer","useRef","state","action","type","data","val","useReducer","current","dispatch","Provider","value","useDialogState","useContext","styles","appContainer","overflow","header","fontStyle","fontWeight","fontSize","textAlign","letterSpacing","left","height","lineHeight","transform","backgroundColor","minWidth","position","page","top","sideBar","right","Frame","sideMenu","showSideMenu","style","id","className","group","paddingLeft","title","marginTop","alignItems","display","width","marginBottom","childrenWrapper","useState","expanded","setExpanded","ref","downArrow","xmlns","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","points","rightArrow","onClick","s","Math","ceil","clientHeight","CurrentFileContext","CurrentFileStateProvider","useCurrentFileState","leftSide","float","svg","marginRight","color","marginLeft","cursor","subHeader","SNView","sideBarTop","justifyContent","borderBottom","sideBarTopOptions","whiteSpace","fileInput","padding","opacity","sideBarContent","line","name","hidden","button","paddingRight","borderRadius","Convert","menuType","setMenuType","editMode","setEditMode","show","setShow","showMenuButtons","setShowMenuButtons","usePreferencesState","preferences","setPreferences","currentFile","setCurrentFile","useEffect","timeout","setTimeout","clearTimeout","a","localStorage","getItem","file_name","JSON","parse","filter","x","e","console","error","navigate","sidebar","file","Blob","stringify","saveAs","autoBom","exportSettings","accept","onChange","reader","FileReader","onload","parsed","target","result","readAsText","files","importSettings","key","Expandable","measuresPerRow","measuresPerRowOptions","map","clefSymbols","clefPreferenceOptions","staffScale","scalePreferenceOptions","horizontalSpacing","spacingPreferenceOptions","verticalSpacing","accidentalType","accidentalTypeOptions","noteScale","naturalNoteShape","noteHeadPreferenceOptions","sharpNoteShape","flatNoteShape","noteSymbolColor","colorPreferenceOptions","noteDurationColor","d","margin","document","getElementById","canvas","getElementsByClassName","pdf","jsPDF","rows","nextRowY","range","length","forEach","i","row","lines","Array","from","getElementsByTagName","getAttribute","split","parseFloat","w","h","canvasHeight","pdfHeight","html","innerHTML","log","rowHeight","reduce","b","addPage","ctx","getContext","fillStyle","fillRect","canvg","ignoreClear","addImage","save","openPDF","MusicXML","serializeScore","exportWork","x1","y1","x2","y2","cx","cy","r","xml","editCallback","setItem","forcedWidth","body","NotFound","GlobalStateProvider","PreferencesStateProvider","bg","frame","border","userSelect","headerRight","maxHeight","overflowY","buttons","bottom","Dialog","dialog","active","startX","startY","mouseX","mouseY","y","drag","setDrag","onMouseMove","clientX","clientY","onMouseUp","onMouseLeave","onMouseDown","contents","Global","components","X","container","flexDirection","item","flex","recentFiles","maxWidth","recentFilesInner","overflowX","recentFilesItem","textOverflow","recentFilesSeparator","recentFilesItemInner","link","deleteAll","icon","Menu","setRecentFiles","installHandle","setInstallHandle","window","addEventListener","preventDefault","setDialogState","showError","recent","loadFile","date_opened","Date","getTime","deleteFile","newRecentFiles","removeItem","deleteSinglePrompt","deleteAllFiles","onUpload","fileName","floor","random","toString","join","date_created","date","getMonth","getDate","getFullYear","paddingTop","src","alt","replace","failedReads","fail","reader1","Error","JSZip","loadAsync","zip","async","details","parser","DOMParser","detailsDOM","parseFromString","nodes","musicXMLPath","musicXMLData","parseScore","measures","readAsArrayBuffer","reader2","uploadFile","prompt","userChoice","then","outcome","Router","path","isLocalhost","Boolean","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","catch","ReactDOM","render","URL","process","href","origin","fetch","response","contentType","headers","get","status","indexOf","ready","unregister","reload","checkValidServiceWorker","colorPreferenceStyles","black","grey","red","orange","yellow","green","blue","purple","Object","keys","PreferencesContext","min","max","res","push","Accidental","setWidth","score","setScore","dialogState","setImmediate","showErrorRef","callback","newWidth","getBoundingClientRect","removeEventListener","revision","noteSymbolSize","small","medium","large","rowPadding","narrow","moderate","wide","horizontalPadding","staffLabelSpace","scoreWidth","beatWidth","tracks","timeSignatures","beats","keyFifths","keySignatures","fifths","staffLabels","octaveLines","number","accidentalMap","noteMap","getNoteAccidental","note","Sharp","Flat","Natural","getNoteLine","movementTitle","work","workTitle","author","identification","creators","creator","credits","creditWords","credit","words","abs","findAuthor","minNote","treble","bass","maxNote","instrumentTrack","track","trackTypes","includes","measure","staff","midi","staffTypes","bassClefIsEmpty","minLine","maxLine","staffHeights","beatsPerMeasure","measureWidth","measureNumber","accum","currentWedge","rowNumber","staffHeight","svgHeight","staffName","bassStaffOnly","textAnchor","dominantBaseline","measureLabelSpace","j","measureNumberToPos","drawWedge","endTime","continuesToNextRow","startMeasure","startTime","continuesFromLastRow","noteTimeToPos","endX","staffBreak","textSize","lyricsSpace","dynamicsSpace","directionsAtRow","directions","slice","dynamicsAreEmpty","every","direction","dynamics","wedge","lyrics","lyricsTrack","find","notesAtRow","lyricsAreEmpty","directionsAtMeasure","time","fontFamily","notesAtMeasure","attributes","contentSVG","pedal","pedals","directionsAreEmpty","pedalText","reverse","currentTime","timeSignature","currentKey","keySignature","getCurrentSignatures","measureSVG","octaveLine","lineY","tickX","tickSize","noteHeadSVG","noteTailSVG","_idx","noteHead","tieStart","tie","tieStop","isLastMeasure","isLastNote","duration","noteSpansRow","noteTail","noteTime","boxes","xStart","yStart","xEnd","roundingSpace","radiusStart","radiusEnd","pointedEnd","fillOpacity","Fragment","accidental","notehead","triHeight","sqrt","crossCircleWidth","autoNoteShape","defaultValue","fingering","setFingering","alignmentBaseline","svgRows","grandStaff","paddingBottom","titleRowHeight","tempo","close","showMessage","buttonText","buttonAction","space","showPrompt","buttonText1","buttonAction1","buttonText2","buttonAction2","module","exports","dynamicsArray","pitchToMidi","pitch","step","c","f","g","toLowerCase","octave","alter","round","lyricsPartId","some","parts","partName","partContainsLyrics","entry","getLyricsPartID","pianoPartId","pianoPart","partList","part","_class","isScorePart","getPianoPartID","currentBeatType","currentBeats","trackIDsToParse","instrumentId","divisions","progress","notes","divisionsToNoteLength","measureEnd","chord","rest","entrySlur","lyricsText","entryTies","ties","staffNumber","entryFingering","notations","notation","slurs","slur","technicals","technical","finger","lyricParts","substitution","placement","alternate","times","parseInt","beatTypes","hasOwnProperty","sound","directionTypes","str","dynamic","offset","partId","trackHasBassStaff","clefs","clef","sign","trackHasOneStaff","trackHasBassStaffOnly","newMeasures","_","index","start","idx","currentMeasureLength","lastNote","measureLength"],"mappings":"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","file":"static/js/main.8b4b2f80.chunk.js","sourcesContent":["import React, {createContext, useContext, useReducer, useRef} from 'react';\n\nexport type state = {\n    shown: boolean,\n    data?: {\n        title: string,\n        contents: any,\n        width: number,\n        height: number,\n    }\n};\nexport type action = {\n    type: 'open', val: state['data'],\n} | {\n    type: 'close',\n};\n\nlet initialState: state = {\n    shown: false,\n};\n\nexport const DialogContext = createContext(undefined! as [state, React.Dispatch<action>]);\nexport const DialogStateProvider: React.FC<{}> = ({children}) => {\n    //we need to use a ref here to ensure that the same reducer is always used\n    let reducer = useRef((state: state, action: action): state => {\n        switch (action.type) {\n            case 'open':\n                return {\n                    shown: true,\n                    data: action.val,\n                };\n            case 'close':\n                return {shown: false};\n        }\n    });\n    let [state, dispatch] = useReducer(reducer.current, initialState);\n    return (\n        <DialogContext.Provider value={[state, dispatch]}>\n            {children}\n        </DialogContext.Provider>\n    );\n};\nexport const useDialogState = () => useContext(DialogContext);\n","import React, {CSSProperties} from \"react\";\n\ntype Props = {\n    header?: string;\n    fontSize?: number;\n    sideMenu?: React.ReactNode;\n    showSideMenu?: boolean;\n};\n\nconst Frame: React.FC<Props> = ({\n    header,\n    fontSize,\n    sideMenu,\n    showSideMenu,\n    children\n}) => {\n    return (\n        <div style={styles.appContainer}>\n\n            {header === undefined ? null : <div id=\"header\" style={{...styles.header, fontSize: fontSize || 40}}>\n                {header}\n            </div>}\n\n            <div style={{...styles.page, ...(header === undefined ? {top: '0px', height: '100%'} : {})}}>{children}</div>\n            <div className={`animated ${showSideMenu ? 'open' : 'close'}`}\n                style={{...styles.sideBar, ...(header === undefined ? {top: '0px', height: '100%'} : {})}}>\n                {sideMenu}\n            </div>\n        </div>\n    );\n};\n\nconst styleMap = {\n    appContainer: {\n        overflow: \"hidden\",\n    },\n    header: {\n        fontStyle: \"normal\",\n        fontWeight: \"normal\",\n        fontSize: \"42px\",\n        textAlign: \"center\",\n        letterSpacing: \"0.05em\",\n        left: \"50%\",\n        height: \"80px\",\n        lineHeight: \"80px\",\n        transform: \"translate(-50%,0px)\",\n        backgroundColor: \"#31B7D6\",\n        minWidth: \"600px\",\n        position: \"absolute\",\n        overflow: 'hidden',\n    },\n    page: {\n        top: \"80px\",\n        height: \"calc(100% - 80px)\",\n        overflow: \"auto\",\n    },\n    sideBar: {\n        backgroundColor: \"rgba(0,0,0,0.7)\",\n        top: \"80px\",\n        height: \"calc(100% - 80px)\",\n        left: \"auto\",\n        right: \"0px\",\n    }\n} as const;\nconst styles: Record<keyof typeof styleMap, CSSProperties> = styleMap;\n\nexport default Frame;\n","import React, {CSSProperties, useState, useRef} from \"react\";\n\ntype Props = {\n    title: string;\n};\n\nconst Frame: React.FC<Props> = ({\n    title,\n    children\n}) => {\n    let [expanded, setExpanded] = useState(false);\n    let ref = useRef(undefined! as HTMLDivElement);\n    let downArrow = <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 -3 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"6 9 12 15 18 9\"></polyline></svg>;\n    let rightArrow = <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 -3 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><polyline points=\"9 18 15 12 9 6\"></polyline></svg>;\n    return (\n        <div style={styles.group}>\n            <div style={styles.title} onClick={() => {setExpanded(s => !s);}}>\n                {expanded ? downArrow : rightArrow} {title}\n            </div>\n            <div className={`animated-height`} style={{...styles.children, height: `${expanded ? Math.ceil(ref === undefined ? 0 : ref.current.clientHeight + 30) : 0}px`}}>\n                <div ref={ref} style={styles.childrenWrapper}>\n                    {children}\n                </div>\n            </div>\n        </div >\n    );\n};\n\nconst styleMap = {\n    group: {\n        paddingLeft: '10px',\n        height: 'auto',\n        position: 'relative',\n    },\n    title: {\n        position: 'relative',\n        height: '40px',\n        marginTop: '30px',\n        alignItems: 'baseline',\n        display: 'flex',\n        width: '100%',\n        lineHeight: '40px',\n        fontSize: '23px',\n    },\n    children: {\n        position: 'relative',\n        paddingLeft: '15px',\n        marginBottom: '30px',\n        overflow: 'hidden',\n    },\n    childrenWrapper: {\n        position: 'relative',\n        height: 'auto',\n    }\n} as const;\nconst styles: Record<keyof typeof styleMap, CSSProperties> = styleMap;\n\nexport default Frame;\n","import React, {createContext, useContext, useReducer, useRef} from 'react';\nimport MusicXML from 'musicxml-interfaces';\n\nexport type state = {\n    id?: string,\n    file_name?: string,\n    data?: MusicXML.ScoreTimewise\n};\nexport type action = {\n    type: 'set', val: state,\n};\n\nlet initialState: state = {};\n\nexport const CurrentFileContext = createContext(undefined! as [state, React.Dispatch<action>]);\nexport const CurrentFileStateProvider: React.FC<{}> = ({children}) => {\n    //we need to use a ref here to ensure that the same reducer is always used\n    let reducer = useRef((state: state, action: action): state => {\n        switch (action.type) {\n            case 'set':\n                return action.val;\n        }\n    });\n    let [state, dispatch] = useReducer(reducer.current, initialState);\n    return (\n        <CurrentFileContext.Provider value={[state, dispatch]}>\n            {children}\n        </CurrentFileContext.Provider>\n    );\n};\nexport const useCurrentFileState = () => useContext(CurrentFileContext);\n","import React, {useEffect, useState, CSSProperties, Fragment} from 'react';\nimport {RouteComponentProps, navigate} from \"@reach/router\";\nimport SNView from '../components/SNView';\nimport Frame from '../components/Frame';\nimport Expandable from '../components/Expandable';\nimport {saveAs} from 'file-saver';\nimport {useCurrentFileState} from '../contexts/CurrentFile';\nimport MusicXML from 'musicxml-interfaces';\nimport {\n    usePreferencesState, colorPreferenceOptions, scalePreferenceOptions,\n    spacingPreferenceOptions, noteHeadPreferenceOptions, measuresPerRowOptions, accidentalTypeOptions, clefPreferenceOptions\n} from '../contexts/Preferences';\nimport jsPDF from 'jspdf';\nimport canvg from 'canvg';\nimport {range} from '../util/Util';\n// import {useDialogState} from '../contexts/Dialog';\n// import * as Dialog from '../util/Dialog';\n\ntype Props = {} & RouteComponentProps;\n\nconst Convert: React.FC<Props> = () => {\n\n    let [menuType, setMenuType] = useState<'preferences' | 'edit'>('preferences');\n    let [editMode, setEditMode] = useState<'' | 'fingerings'>('');\n    let [show, setShow] = useState(false);\n    let [showMenuButtons, setShowMenuButtons] = useState(true);\n\n\n    let [preferences, setPreferences] = usePreferencesState();\n    let [currentFile, setCurrentFile] = useCurrentFileState();\n    // let [, setDialogState] = useDialogState();\n\n    \n\n    // let showError = (error: string)=>{\n    //     setDialogState(Dialog.showMessage('An Error Occurred',error,'Close',()=>{\n    //         setDialogState(Dialog.close());\n    //     }));\n    // }\n\n    useEffect(() => {\n        if (show) {\n            setShowMenuButtons(false);\n            return () => {};\n        } else {\n            let timeout = setTimeout(() => {\n                setShowMenuButtons(true);\n            }, 1000);\n            return () => {\n                clearTimeout(timeout);\n            };\n        }\n    }, [show]);\n\n    useEffect(() => {\n        (async () => {\n            // If the current file is not in the context,\n            if (currentFile.id === undefined) {\n                try {\n                    // Load the current file data from localStorage\n                    let id = localStorage.getItem('current_file')!;\n                    let file_name = JSON.parse(localStorage.getItem('recent_files')!).filter((x: any) => x.id === id)[0].file_name;\n                    let data = JSON.parse(localStorage.getItem(id)!);\n                    setCurrentFile({type: 'set', val: {id, file_name, data}});\n                } catch (e) {\n                    console.error(e);\n                    navigate('..');\n                }\n            }\n        })();\n    }, [currentFile.id, setCurrentFile]);\n\n    let openPDF = () => {\n        try {\n\n            // should change with preferences - as percent of page width\n            let margin = 5;\n            let padding = 0; //between lines within each row\n            let paddingBetweenRows = 5; //between rows\n\n            let hidden = document.getElementById('hidden-pdf-generation') as HTMLDivElement;\n            let canvas = document.getElementsByClassName('canvas')[0] as HTMLCanvasElement;\n\n            let pdf = new jsPDF(); //210 x 297 mm (A4 paper dimensions)\n            let width = 210;\n            let height = 297;\n\n            margin = width * margin / 100;\n            padding = width * padding / 100;\n\n            let rows = hidden.getElementsByClassName('snview-row');\n\n            let nextRowY = margin;\n            range(0, rows.length).forEach(i => {\n                let row = rows[i];\n\n                let lines = Array.from(row.getElementsByTagName('div')).map(line=>{\n                    let svg = line.getElementsByTagName('svg')[0];\n                    let [, , w, h] = svg.getAttribute('viewBox')!.split(' ').map(x => Math.ceil(parseFloat(x)));\n\n\n\n                    //canvas is 1000 px wide, this determine the height required to render the row\n                    let canvasHeight = Math.ceil(1000 * h / w);\n\n                    //determines the row's height on the pdf in mm based upon the row's width\n                    let pdfHeight = Math.ceil((width - margin * 2) * h / w);\n\n                    return {\n                        w,\n                        h,\n                        canvasHeight,\n                        pdfHeight,\n                        html: line.innerHTML,\n                    };\n                });\n\n                console.log('Row');\n\n                // if the row is small enough to fit on one page but not small enough to fit on the current page, add a new page\n                let rowHeight = lines.reduce((a,b)=>a+b.pdfHeight+padding,-padding);\n                if (rowHeight < height - margin*2 && nextRowY + rowHeight > height - margin) {\n                    console.log('Fits on one page but not this page');\n                    pdf.addPage();\n                    nextRowY = margin;\n                } else {\n                    //console.log('Fits on this page or does not fit on any page')\n                }\n\n                // add each line to the page, overflowing if needed\n                lines.forEach(line=>{\n                    if (nextRowY + line.pdfHeight > height - margin) {\n                        pdf.addPage();\n                        nextRowY = margin;\n                    }\n\n                    canvas.height = line.canvasHeight;\n                    let ctx = canvas.getContext(\"2d\")!;\n                    ctx.fillStyle = \"white\";\n                    ctx.fillRect(0, 0, canvas.width, canvas.height);\n                    ctx.fillStyle = \"black\";\n                    canvg(canvas, line.html, {ignoreClear: true});\n                    try {\n                        pdf.addImage(canvas, 'JPEG', margin, nextRowY, width - margin * 2, line.pdfHeight);\n                    } catch(e){\n                        console.error(e);\n                    }\n\n                    nextRowY += line.pdfHeight + padding;\n                });\n\n                // add additional padding between each row\n                nextRowY += paddingBetweenRows - padding;\n            });\n\n            // pdf.rect(0,0,200,287,'F');\n            // pdf.addPage();\n            // pdf.rect(0,10,200,287,'F');\n\n            //(pdf as any).addSvgAsImage(document.getElementById('snview')!.innerHTML, 0, 0, 1000, 1000);\n            pdf.save(`${currentFile.file_name || 'WYSIWYP'}.pdf`);\n        } catch (e) {\n            console.error(e);\n        }\n    };\n    let exportWork = () => {\n        let file = new Blob([MusicXML.serializeScore(currentFile.data!)], {type: 'text/plain'});\n        saveAs(file, `${currentFile.file_name}.musicxml`, {\n            autoBom: false,\n        });\n    };\n    let exportSettings = () => {\n        let file = new Blob([JSON.stringify(preferences, null, 4)], {type: 'text/plain'});\n        saveAs(file, 'preferences.snapp', {\n            autoBom: false,\n        });\n    };\n    let importSettings = (e: React.ChangeEvent<HTMLInputElement>) => {\n        try {\n            let reader = new FileReader();\n            reader.onload = function (e) {\n                try {\n                    let parsed = JSON.parse((e.target as any).result);\n                    setPreferences({type: 'set', val: parsed});\n                } catch (e) {\n                    console.error(e);\n                }\n            };\n            reader.readAsText((e.target as any).files[0]);\n        } catch (e) {\n            console.error(e);\n        }\n        e.target.value = \"\";\n    };\n    let sidebar = (\n        <div style={styles.sideBar}>\n            <div style={styles.sideBarTop}>\n                {menuType==='edit'?<>\n                    <div style={{position: 'relative', width: '60%', height: 'auto'}} />\n                </>:<>\n                    <div id=\"export\" title=\"Click to save your preferences\" style={styles.sideBarTopOptions} onClick={() => {exportSettings();}}>\n                        Save\n                    </div>\n                    <div id=\"import\" style={styles.sideBarTopOptions}>\n                        Open\n                        <input style={styles.fileInput} type=\"file\" title=\"Click to load your preferences\" accept=\".snapp\" onChange={(e) => {importSettings(e);}}></input>\n                    </div>\n                </>}\n                <div id=\"close\" style={styles.sideBarTopOptions} onClick={() => {setShow(false);}}>\n                    Close ✕\n                </div>\n            </div>\n\n            <div style={styles.sideBarContent}>\n                {menuType==='edit'?<Fragment key=\"edit\">\n                    <Expandable title=\"Note Properties\">\n\n                        <div style={{...styles.line, justifyContent: 'flex-start'}}>\n                            <div style={{...styles.name, ...styles.button}} onClick={()=>{setEditMode('fingerings'); setShow(false);}}>Fingerings</div>\n                        </div>\n\n                    </Expandable>\n                </Fragment>:<Fragment key=\"preferences\">\n\n                    <Expandable title=\"Staff Appearance\">\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Measures per Row</div>\n                            <select value={preferences.measuresPerRow} onChange={\n                                (e) => {setPreferences({type: 'set', val: {measuresPerRow: e.target.value as any}});}\n                            }>{measuresPerRowOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Clef Symbols</div>\n                            {/* deleted value and onchange */}\n                            <select value={preferences.clefSymbols} onChange={\n                                (e) => {setPreferences({type: 'set', val: {clefSymbols: e.target.value as any}});}\n                            }>{clefPreferenceOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Clef Size</div>\n                            {/* deleted value and onchange */}\n                            <select value={preferences.staffScale} onChange={\n                                (e) => {setPreferences({type: 'set', val: {staffScale: e.target.value as any}});}\n                            }>{scalePreferenceOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Margin Size</div>\n                            {/* deleted value and onchange */}\n                            <select value={preferences.horizontalSpacing} onChange={\n                                (e) => {setPreferences({type: 'set', val: {horizontalSpacing: e.target.value as any}});}\n                            }>{spacingPreferenceOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Staff Spacing Size</div>\n                            {/* deleted value and onchange */}\n                            <select value={preferences.verticalSpacing} onChange={\n                                (e) => {setPreferences({type: 'set', val: {verticalSpacing: e.target.value as any}});}\n                            }>{spacingPreferenceOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                    </Expandable>\n\n                    <Expandable title=\"Note Appearance\">\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Accidental Type</div>\n                            <select value={preferences.accidentalType} onChange={\n                                (e) => {setPreferences({type: 'set', val: {accidentalType: e.target.value as any}});}\n                            }>{accidentalTypeOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Note Size</div>\n                            {/* deleted value and onchange */}\n                            <select value={preferences.noteScale} onChange={\n                                (e) => {setPreferences({type: 'set', val: {noteScale: e.target.value as any}});}\n                            }>{scalePreferenceOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Natural Notehead</div>\n                            {/* deleted value and onchange */}\n                            <select value={preferences.naturalNoteShape} onChange={\n                                (e) => {setPreferences({type: 'set', val: {naturalNoteShape: e.target.value as any}});}\n                            }>{noteHeadPreferenceOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Sharp Notehead</div>\n                            {/* deleted value and onchange */}\n                            <select value={preferences.sharpNoteShape} onChange={\n                                (e) => {setPreferences({type: 'set', val: {sharpNoteShape: e.target.value as any}});}\n                            }>{noteHeadPreferenceOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Flat Notehead</div>\n                            {/* deleted value and onchange */}\n                            <select value={preferences.flatNoteShape} onChange={\n                                (e) => {setPreferences({type: 'set', val: {flatNoteShape: e.target.value as any}});}\n                            }>{noteHeadPreferenceOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Notehead Color</div>\n                            <select value={preferences.noteSymbolColor} onChange={\n                                (e) => {setPreferences({type: 'set', val: {noteSymbolColor: e.target.value as any}});}\n                            }>{colorPreferenceOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                        <div style={styles.line}>\n                            <div style={styles.name}>Duration Color</div>\n                            <select value={preferences.noteDurationColor} onChange={\n                                (e) => {setPreferences({type: 'set', val: {noteDurationColor: e.target.value as any}});}\n                            }>{colorPreferenceOptions.map(x => <option key={x}>{x}</option>)}</select>\n                        </div>\n\n                    </Expandable>\n                </Fragment>}\n            </div>\n\n        </div>);\n\n    return (\n        <Frame showSideMenu={show} sideMenu={sidebar}>\n            <div style={styles.subHeader}>\n\n                <div style={styles.left} onClick={() => {navigate('/');}}>\n                    <svg style={styles.svg} xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z\"></path><polyline points=\"9 22 9 12 15 12 15 22\"></polyline></svg>\n                    SNapp Home\n                </div>\n                <div style={styles.left} onClick={() => {openPDF();}}>\n                    <svg style={styles.svg} xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z\"></path><polyline points=\"13 2 13 9 20 9\"></polyline></svg>\n                    Save as PDF\n                </div>\n                <div style={styles.left} onClick={() => {exportWork();}}>\n                    <svg style={styles.svg} xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"></path><polyline points=\"7 10 12 15 17 10\"></polyline><line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"></line></svg>\n                    Export\n                </div>\n\n                {!showMenuButtons ? null : <>\n                    {editMode===''?<>\n                        <div style={styles.right} onClick={() => {setMenuType('edit'); setShow(true);}} >\n                            <svg style={styles.svg} xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path><path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path></svg>\n                            Edit\n                        </div>\n                        <div style={styles.right} onClick={() => {setMenuType('preferences'); setShow(true);}} >\n                            <svg style={styles.svg} xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2.5\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"3\"></circle><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z\"></path></svg>\n                            Preferences\n                        </div>\n                    </>:<>\n                        <div style={styles.right} onClick={() => {setShow(true); setTimeout(()=>{setEditMode('');},10);}} >\n                            Done\n                        </div>\n                    </>}\n                </>}\n\n\n                    \n\n            </div>\n            <div style={styles.SNView} onClick={() => {setShow(false);}}>\n                {currentFile.data === undefined ? null : <SNView xml={currentFile.data} editMode={editMode} editCallback={()=>{\n                    try {\n                        localStorage.setItem(currentFile.id!, JSON.stringify(currentFile.data));\n                    } catch(e){}\n                }} />}\n            </div>\n\n            <div id=\"hidden-pdf-generation\" style={styles.hidden}>\n                <canvas className=\"canvas\" width={1000} height={1000} />\n                {currentFile.data === undefined ? null : <SNView xml={currentFile.data} forcedWidth={1000} />}\n            </div>\n\n        </Frame>\n\n\n    );\n};\n\nconst styleMap = {\n    leftSide: {\n        float: 'left',\n        width: '80%',\n    },\n\n    svg: {\n        marginRight: '7px',\n    },\n    // snv:{\n    //     top: '200px',\n    // },\n\n    left: {\n        display: 'flex',\n        alignItems: 'center',\n        height: 'auto',\n        color: '#31B7D6',\n        marginTop: '15px',\n        marginLeft: '25px',\n        fontSize: '23px',\n        fontWeight: 'bold',\n        cursor: 'pointer',\n        position: 'relative',\n        float: 'left',\n        width: 'auto',\n    },\n    right: {\n        display: 'flex',\n        alignItems: 'center',\n        height: 'auto',\n        marginTop: '15px',\n        fontWeight: 'bold',\n        color: '#31B7D6',\n        fontSize: '23px',\n        marginRight: '25px',\n        position: 'relative',\n        float: 'right',\n        width: 'auto',\n        cursor: 'pointer',\n    },\n\n    subHeader: {\n        height: '65px',\n    },\n    SNView: {\n        top: '65px',\n        height: 'calc(100% - 65px)',\n        overflow: 'auto',\n    },\n    sideBar: {\n        color: 'white',\n        minWidth: '350px',\n    },\n    sideBarTop: {\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        borderBottom: 'solid 1px #bbb',\n        height: '65px',\n        color: '#31B7D6',\n        fontSize: '23px',\n        fontWeight: 'bold',\n    },\n    sideBarTopOptions: {\n        position: 'relative',\n        width: '33%',\n        height: 'auto',\n        whiteSpace: 'nowrap',\n        textAlign: 'center',\n        cursor: 'pointer',\n    },\n    fileInput: {\n        position: 'absolute',\n        top: '0px',\n        left: '0px',\n        width: '100%',\n        height: '100%',\n        cursor: 'pointer',\n        padding: '0px',\n        opacity: 0,\n    },\n    sideBarContent: {\n        position: 'absolute',\n        top: '65px',\n        height: 'calc(100% - 65px)',\n        overflow: 'auto',\n    },\n    line: {\n        marginTop: '30px',\n        marginBottom: '30px',\n        justifyContent: 'center',\n        alignItems: 'baseline',\n        display: 'flex',\n        position: 'relative',\n        height: 'auto',\n        width: '100%'\n    },\n    name: {\n        position: 'relative',\n        width: '50%',\n        display: 'inline-block'\n    },\n    hidden: {\n        width: '0px',\n        height: '0px',\n        overflow: 'hidden',\n        opacity: .01,\n    },\n    button: {\n        width: 'auto',\n        height: '40px',\n        lineHeight: '40px',\n        marginLeft: '40px',\n        cursor: 'pointer',\n        color: 'black',\n        backgroundColor: 'rgba(255, 255, 255, 0.6)',\n        position: 'relative',\n        display: 'inline-block',\n        paddingLeft: '20px',\n        paddingRight: '20px',\n        borderRadius: '10px',\n        fontSize: '17px',\n    }\n} as const;\nconst styles: Record<keyof typeof styleMap, CSSProperties> = styleMap;\n\n\nexport default Convert;\n","import React, {CSSProperties} from 'react';\nimport {RouteComponentProps} from \"@reach/router\";\n\ntype Props = {} & RouteComponentProps;\n\nconst NotFound: React.FC<Props> = () => {\n    return (\n        <div style={styles.body}>\n            That page could not be found\n        </div>\n    );\n};\n\nconst styleMap = {\n    body: {\n        top: '50%',\n        height: 'auto',\n        transform: 'translate(0px,-50px)',\n        textAlign: 'center',\n        fontSize: '22px',\n    },\n} as const;\nconst styles: Record<keyof typeof styleMap,CSSProperties> = styleMap;\n\nexport default NotFound;\n","import React from 'react';\nimport {DialogStateProvider} from './Dialog';\nimport {CurrentFileStateProvider} from './CurrentFile';\nimport {PreferencesStateProvider} from './Preferences';\n\nconst GlobalStateProvider: React.FC<{}> = ({children}) => {\n    //we need to use a ref here to ensure that the same reducer is always used\n    let stateProviders = [DialogStateProvider, CurrentFileStateProvider, PreferencesStateProvider] as React.FunctionComponent[];\n    stateProviders.forEach(x=>{\n        children = x({children});\n    });\n    return <>{children}</>;\n};\nexport default GlobalStateProvider;\n","import React, {useEffect, useState, CSSProperties} from 'react';\nimport {useDialogState} from '../../contexts/Dialog';\n//import Button from '../Button';\n\ntype Props = {};\n\nconst Dialog: React.FC<Props> = () => {\n\n    let [dialog,] = useDialogState();\n    let data = dialog.data!;\n\n    let [drag, setDrag] = useState({active: false, startX: 0, startY: 0, mouseX: 0, mouseY: 0, x: 0, y: 0});\n\n    useEffect(()=>{\n        if(drag.x !== 0 && drag.y !== 0 && !dialog.shown){\n            setDrag({...drag, x: 0, y: 0});\n        }\n    },[drag,dialog.shown]);\n\n    return (\n        !dialog.shown?null:<div\n            style={styles.bg}\n            onMouseMove={(e)=>{setDrag({...drag, mouseX: e.clientX, mouseY: e.clientY, ...(drag.active?{x: drag.mouseX-drag.startX, y: drag.mouseY-drag.startY}:{})});}}\n            onMouseUp={()=>{setDrag({...drag, active: false});}}\n            onMouseLeave={()=>{setDrag({...drag, active: false});}}\n        >\n            <div style={{\n                ...styles.frame,\n                top: `calc(50% + ${drag.y}px)`,\n                left: `calc(50% + ${drag.x}px)`,\n                width: `${data.width}px`,\n                height: `${data.height}px`,\n            }}>\n                <div style={{...styles.header, fontSize: 30 || 45}}\n                    onMouseDown={()=>{setDrag({...drag, active: true, startX: drag.mouseX-drag.x, startY: drag.mouseY-drag.y});}}\n                >\n                    {data.title}\n                    <div style={styles.headerRight}>\n                        {undefined || ''}\n                    </div>\n                </div>\n                <div style={styles.body}>\n                    {data.contents}\n                    {/*<div style={styles.buttons}><Button text={data.buttons[0].text} action={data.buttons[0].action || (()=>{dispatchDialog({type: 'close'})})} /></div>*/}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nconst styleMap = {\n    bg: {\n        position: 'fixed',\n        backgroundColor: '#00000099',\n    },\n    frame: {\n        border: '2px solid #444',\n        overflow: 'hidden',\n        transform: 'translate(-50%,-50%)',\n        borderRadius: '10px',\n    },\n    header: {\n        height: '50px',\n        backgroundColor: '#ddd',\n        lineHeight: '50px',\n        textAlign: 'center',\n        userSelect: 'none',\n        borderBottom: '1px solid #444',\n    },\n    headerRight: {\n        left: 'auto',\n        right: '20px',\n        width: 'auto',\n        fontSize: '15px',\n    },\n    body: {\n        top: '50px',\n        backgroundColor: '#fff',\n        height: 'calc(100% - 50px)',\n    },\n    page: {\n        top: 'calc(50% - 40px)',\n        left: '50%',\n        height: 'auto',\n        width: '85%',\n        maxHeight: 'calc(100% - 120px)',\n        textAlign: 'center',\n        fontSize: '25px',\n        transform: 'translate(-50%, -50%)',\n        overflowY: 'auto',\n    },\n    buttons: {\n        top: 'auto',\n        bottom: '20px',\n        left: '50%',\n        width: '200px',\n        height: '60px',\n        transform: 'translate(-50%, 0px)',\n    },\n} as const;\nconst styles: Record<keyof typeof styleMap, CSSProperties> = styleMap;\n\nexport default Dialog;\n","import React from 'react';\nimport Dialog from './Dialog';\n\nconst Global: React.FC<{}> = ({children}) => {\n    //we need to use a ref here to ensure that the same reducer is always used\n    let components = [Dialog] as React.FunctionComponent[];\n    components.forEach(x=>{\n        children = x({children});\n    });\n    return <>{components.map((X,i)=><X key={i}></X>)}</>;\n};\nexport default Global;\n","import React, { CSSProperties, useState, useEffect, Fragment } from 'react';\nimport { RouteComponentProps, navigate } from \"@reach/router\";\nimport Frame from '../components/Frame';\nimport svg from '../images/upload.svg';\nimport MusicXML, { ScoreTimewise } from 'musicxml-interfaces';\nimport { useCurrentFileState } from '../contexts/CurrentFile';\nimport { useDialogState } from '../contexts/Dialog';\nimport * as Dialog from '../util/Dialog';\nimport JSZip from 'jszip';\n\ntype Props = {} & RouteComponentProps;\n\nconst Menu: React.FC<Props> = () => {\n    type recentFile = {\n        file_name: string,\n        date_created: number,\n        date_opened: number,\n        id: string,\n    };\n\n    let [recentFiles, setRecentFiles] = useState<recentFile[]>(undefined!);\n    let [installHandle, setInstallHandle] = useState<{\n        prompt: ()=>void,\n        userChoice: Promise<{outcome: 'accepted'|'rejected'}>\n    } | undefined>(undefined);\n    useEffect(()=>{\n        window.addEventListener('beforeinstallprompt', (e) => {\n            // Prevent Chrome 67 and earlier from automatically showing the prompt\n            e.preventDefault();\n            // Stash the event so it can be triggered later.\n            setInstallHandle(e as any);\n        });\n    },[]);\n\n    let [, setDialogState] = useDialogState();\n    let [, setCurrentFile] = useCurrentFileState();\n\n    let showError = (error: string) => {\n        setDialogState(Dialog.showMessage('An Error Occurred', error, 'Close', () => {\n            setDialogState(Dialog.close());\n        }));\n     };\n\n    let deleteAllPrompt = () => {\n        setDialogState(Dialog.showPrompt('Delete Confirmation', 'Are you sure you want to delete all files?', 'Close', () => {\n            setDialogState(Dialog.close());\n        }, 'Delete', () => {\n            recentFiles.forEach(x=>{\n                localStorage.removeItem(x.id);\n            });\n            setRecentFiles([]);\n            localStorage.setItem('recent_files', JSON.stringify([]));\n            setDialogState(Dialog.close());\n        }));\n    };\n    let deleteSinglePrompt = (x: recentFile) => {\n        setDialogState(Dialog.showPrompt('Delete Confirmation', 'Are you sure you want to delete this file?', 'Close', () => {\n            setDialogState(Dialog.close());\n        }, 'Delete', () => {\n            let newRecentFiles = recentFiles.filter(y => y.id !== x.id);\n            setRecentFiles(newRecentFiles);\n            localStorage.setItem('recent_files', JSON.stringify(newRecentFiles));\n            localStorage.removeItem(x.id);\n            setDialogState(Dialog.close());\n        }));\n    };\n\n    useEffect(() => {\n        let recent: recentFile[] = null!;\n        try {\n            recent = JSON.parse(localStorage.getItem('recent_files')!);\n        } catch (e) { }\n        if (recent === null) {\n            recent = [];\n        }\n        setRecentFiles(recent);\n    }, []);\n\n    const loadFile = (x: recentFile) => {\n        try {\n            let parsed = JSON.parse(localStorage.getItem(x.id)!);\n\n            // Set this song as the current work in the global context\n            setCurrentFile({ type: 'set', val: { id: x.id, file_name: x.file_name, data: parsed } });\n\n            try {\n                // Set this song as the current work in localStorage\n                localStorage.setItem('current_file', x.id);\n\n                // Update the accessed date for this song and move it to the top of the list\n                localStorage.setItem('recent_files', JSON.stringify([\n                    { ...x, date_opened: new Date().getTime() } as recentFile,\n                    ...recentFiles.filter(y => y.id !== x.id)\n                ]));\n            } catch (e) {\n                // Writing to local storage may be disabled currently\n                console.error(e);\n            }\n\n            navigate('convert');\n        } catch (e) {\n            showError('An issue was encountered while loading the data for this file.');\n            console.error(e);\n        }\n    };\n\n    const deleteFile = (x: recentFile) => {\n        try {\n            deleteSinglePrompt(x);\n            // let newRecentFiles = recentFiles.filter(y => y.id !== x.id);\n            // setRecentFiles(newRecentFiles);\n            // localStorage.setItem('recent_files', JSON.stringify(newRecentFiles));\n        } catch (e) {\n            showError('An issue was encountered while deleting this file.');\n            console.error(e);\n        }\n    };\n\n    const deleteAllFiles = () => {\n        try {\n            deleteAllPrompt();\n        } catch (e) {\n            showError('An issue was encountered while deleting all file(s).');\n            console.error(e);\n        }\n    };\n\n    const uploadFile = (e: React.ChangeEvent<HTMLInputElement>) => {\n        let fileName = (e.target as any).files[0].name.replace(/\\.(?:musicxml|mxl|xml)$/i, '');\n        let failedReads = 0;\n        let fail = () => {\n            failedReads++;\n            if (failedReads === 2) { //both reads failed\n                showError('An issue was encountered while reading the selected file.');\n            }\n        };\n        try {\n            let reader1 = new FileReader();\n            reader1.onload = function () {\n                try {\n                    let data = reader1.result;\n                    if (data === null) {\n                        throw new Error('Failed to read file - null');\n                    }\n                    //try to interpret this file as compressed\n\n                    (async () => {\n                        try {\n                            let zip = await JSZip.loadAsync(data);\n                            let details = await zip.file('META-INF/container.xml').async(\"text\");\n                            let parser = new DOMParser();\n                            let detailsDOM = parser.parseFromString(details, \"application/xml\");\n                            let nodes = detailsDOM.getElementsByTagName('rootfile');\n                            let musicXMLPath = nodes[0].getAttribute('full-path')!;\n                            for (let i = nodes.length - 1; i >= 0; i--) {\n                                if (nodes[i].getAttribute('media-type') === 'application/vnd.recordare.musicxml+xml') {\n                                    musicXMLPath = nodes[i].getAttribute('full-path')!;\n                                }\n                            }\n                            let musicXMLData = await zip.file(musicXMLPath).async(\"text\");\n                            let parsed = MusicXML.parseScore(musicXMLData);\n                            if (parsed.measures === undefined) {\n                                throw new Error('Invalid MusicXML format');\n                            }\n                            onUpload(fileName, parsed);\n                        } catch (e) {\n                            fail();\n                            console.error(e);\n                        }\n                    })();\n                } catch (e) {\n                    fail();\n                    console.error(e);\n                }\n            };\n            reader1.readAsArrayBuffer((e.target as any).files[0]);\n            let reader2 = new FileReader();\n            reader2.onload = function () {\n                try {\n                    let data = reader2.result;\n                    if (data === null) {\n                        throw new Error('Failed to read file - null');\n                    }\n                    //try to interpret this file as uncompressed\n                    let parsed = MusicXML.parseScore(data as string);\n\n                    if (parsed.measures === undefined) {\n                        throw new Error('Invalid MusicXML format');\n                    }\n                    console.log(parsed);\n\n                    onUpload(fileName, parsed);\n                } catch (e) {\n                    fail();\n                    console.error(e);\n                }\n            };\n            reader2.readAsText((e.target as any).files[0]);\n\n\n\n\n\n            // let reader = new FileReader();\n            // reader.onload = function () {\n            //     try {\n            //         let data = reader.result;\n            //         let parsed: ScoreTimewise;\n            //         if(data === null){\n            //             throw new Error('Failed to read file - null');\n            //         }\n            //         try {\n            //             //try to interpret this file as uncompressed\n            //             parsed = MusicXML.parseScore(data.toString());\n            //             console.log(data.toString());\n            //             console.log(parsed);\n            //         } catch(e){\n\n            //             throw new Error('...');\n            //         }\n\n            //         let id = `file_${Array.from({length: 16}, () => Math.floor(Math.random() * 16).toString(16)).join('')}`;\n\n            //         // Set this song as the current work in the global context\n            //         setCurrentFile({type: 'set', val: {id, file_name: fileName, data: parsed}});\n\n            //         // Fail silently if localStorage is disabled\n            //         try {\n\n            //             // Set this song as the current work in localStorage\n            //             localStorage.setItem(id, JSON.stringify(parsed));\n            //             localStorage.setItem('current_file', id);\n\n            //             // Add this song to the recent songs list\n            //             let newRecentFiles = recentFiles.map(x => x);\n\n            //             for (let i = 0; i < newRecentFiles.length; i++) {\n            //                 if (newRecentFiles[i]['file_name'] === fileName) {\n            //                     newRecentFiles.splice(i, 1);\n            //                 }\n            //             }\n\n            //             newRecentFiles.unshift({file_name: fileName, date: new Date().getTime(), id});\n            //             localStorage.setItem('recent_files', JSON.stringify(newRecentFiles));\n\n            //         } catch (e) {\n            //             console.error(e);\n            //         }\n\n            //         navigate('convert');\n            //     } catch (e) {\n            //         showError('An issue was encountered while reading the selected file.');\n            //         console.error(e);\n            //     }\n            // };\n            // reader.readAsArrayBuffer((e.target as any).files[0]);\n        } catch (e) {\n            showError('An issue was encountered while reading the selected file.');\n            console.error(e);\n        }\n    };\n\n    const onUpload = (fileName: string, parsed: ScoreTimewise) => {\n        let id = `file_${Array.from({ length: 16 }, () => Math.floor(Math.random() * 16).toString(16)).join('')}`;\n\n        // Set this song as the current work in the global context\n        setCurrentFile({ type: 'set', val: { id, file_name: fileName, data: parsed } });\n\n        // Fail silently if localStorage is disabled\n        try {\n\n            // Set this song as the current work in localStorage\n            localStorage.setItem(id, JSON.stringify(parsed));\n            localStorage.setItem('current_file', id);\n\n            // Add this song to the recent songs list\n            localStorage.setItem('recent_files', JSON.stringify([\n                { file_name: fileName, date_created: new Date().getTime(), date_opened: new Date().getTime(), id } as recentFile,\n                ...recentFiles.filter(x => x.file_name !== fileName)\n            ]));\n\n        } catch (e) {\n            console.error(e);\n        }\n\n        navigate('convert');\n    };\n\n    return (\n        <Frame header=\"SNapp -&nbsp;Simplified&nbsp;Notation&nbsp;App&nbsp;for&nbsp;Sheet&nbsp;Music\">\n            {recentFiles === undefined ? null : <div style={styles.container}>\n                <div style={{ ...styles.item, flex: '1 0 auto' }} />\n                <div style={{ ...styles.item, maxWidth: '750px' }}>\n                    SNapp implements a simple and intuitive music notation known as What You See Is What You Play,\n                    or WYSIWYP. With it, musicians can spend less time learning to read music and more time playing it!\n                </div>\n                {recentFiles.length === 0 ? <>\n                    <div style={{ ...styles.item, flex: '.2 0 auto' }} />\n                    <div style={styles.item}>\n                        Try uploading a MusicXML file below\n                    </div>\n                    <div style={{ ...styles.item, flex: '.35 0 auto' }} />\n                </> : <>\n                        <div style={{ ...styles.item, flex: '.36 0 auto' }} />\n                        <div style={{ ...styles.item, fontSize: '28px', fontWeight: 'bolder' }}>Recent Files</div>\n                        <div style={{ ...styles.item, flex: '.08 0 auto' }} />\n                        <div style={{ ...styles.item, ...styles.recentFiles }}>\n                            <div style={{ ...styles.recentFilesInner }}>\n                                {recentFiles.map(x => <Fragment key={x.id}>\n                                    <div className=\"button-recent-file\" style={styles.recentFilesItem}>\n                                        <div onClick={() => { loadFile(x); }} style={{ ...styles.recentFilesItemInner, flex: '0 1 auto', fontWeight: 'bold' }}>\n                                            {x.file_name}\n                                        </div>\n                                        <div onClick={() => { loadFile(x); }} style={{ ...styles.recentFilesItemInner, width: '10px', flex: '1 1 auto' }} />\n                                        <div onClick={() => { loadFile(x); }} style={{ ...styles.recentFilesItemInner, flex: '0 100000 auto', fontSize: '22px' }}>\n                                            {(d => `${d.getMonth() + 1}/${d.getDate()}/${d.getFullYear()}`)(new Date(x.date_created || (x as any).date /*migrate from x.date to x.date_created*/))}\n                                        </div>\n                                        <div onClick={() => { deleteFile(x); }} style={{ ...styles.recentFilesItemInner, color: 'gray', width: '35px' }} >\n                                            <svg style={{ paddingTop: '9px' }} xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"></line><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"></line></svg>\n                                        </div>\n                                    </div>\n                                    <div style={styles.recentFilesSeparator}></div>\n                                </Fragment>)}\n                                <div onClick={() => { deleteAllFiles(); }} style={styles.deleteAll}>Delete All Files</div>\n                            </div>\n                        </div>\n                        <div style={{ ...styles.item, flex: '.24 0 auto' }} />\n                    </>}\n                <div style={styles.item}>\n                    <span id=\"button-upload\" style={styles.link}>\n                        <img src={svg} style={styles.icon} alt=\"\" />\n                        Open MusicXML File\n                        <input style={styles.fileInput} type=\"file\" title=\"Click to upload\" accept=\".musicxml,.mxl,.xml\" onChange={(e) => { uploadFile(e); }}></input>\n                    </span>\n                </div>\n                {installHandle===undefined?null:<>\n                    <div style={{ ...styles.item, flex: '.5 0 auto' }} />\n                    <div style={{ ...styles.item, maxWidth: '720px' }}>\n                        Click the button below to add SNapp to your device's home screen.\n                    </div>\n                    <div style={{ ...styles.item, flex: '.07 0 auto' }} />\n                    <div style={styles.item}>\n                        <span id=\"button-upload\" style={styles.link} onClick={() => {\n                            installHandle!.prompt();\n                            installHandle!.userChoice.then(result=>{\n                                if (result.outcome === 'accepted') {\n                                    setInstallHandle(undefined);\n                                }\n                            });\n                        }}>\n                            Add to Home Screen\n                        </span>\n                    </div>\n                </>}\n                <div style={{ ...styles.item, flex: '1 0 auto' }} />\n            </div>}\n        </Frame>\n    );\n};\n\nconst styleMap = {\n    container: {\n        display: 'flex',\n        flexDirection: 'column',\n        overflow: 'hidden',\n    },\n    item: {\n        position: 'initial',\n        top: 'auto',\n        left: 'auto',\n        height: 'auto',\n        marginLeft: '50%',\n        width: '70%',\n        transform: 'translate(-50%,0px)',\n        textAlign: 'center',\n        fontSize: '21px',\n        flex: '0 0 auto',\n    },\n    fileInput: {\n        position: 'absolute',\n        top: '0px',\n        left: 'calc(50% - 170px)',\n        width: '340px',\n        height: '100%',\n        cursor: 'pointer',\n        opacity: 0,\n    },\n    recentFiles: {\n        color: '#31B7D6',\n        maxWidth: '750px',\n        height: '250px',\n        borderRadius: '10px',\n        border: '2px solid #BBBBBB',\n        padding: '5px',\n        overflow: 'hidden',\n    },\n    recentFilesInner: {\n        position: 'relative',\n        paddingLeft: '15px',\n        paddingRight: '15px',\n        overflowX: 'hidden',\n        overflowY: 'auto',\n    },\n    recentFilesItem: {\n        display: 'flex',\n        width: 'calc(100% - 10px)',\n        marginTop: '20px',\n        marginLeft: '5px',\n        marginRight: '5px',\n        lineHeight: '40px',\n        fontSize: '24px',\n        position: 'relative',\n        height: '40px',\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        cursor: 'pointer',\n    },\n    recentFilesSeparator: {\n        position: 'relative',\n        height: '2px',\n        backgroundColor: '#DDDDDD',\n        borderRadius: '10px',\n    },\n    recentFilesItemInner: {\n        position: 'initial',\n        width: 'auto',\n        flex: '0 0 auto',\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n    },\n    link: {\n        color: '#31B7D6',\n        cursor: 'pointer',\n        fontSize: '28px',\n        fontWeight: 'bold',\n    },\n    deleteAll: {\n        position: 'relative',\n        height: '40px',\n        width: '200px',\n        fontSize: '22px',\n        lineHeight: '40px',\n        left: '50%',\n        transform: 'translate(-50%, 0)',\n        cursor: 'pointer',\n    },\n    icon: {\n        height: '1em',\n        width: '1em',\n        position: 'relative',\n        display: 'inline-flex',\n        top: '.125em',\n        marginRight: '.25em',\n    },\n} as const;\nconst styles: Record<keyof typeof styleMap, CSSProperties> = styleMap;\n\nexport default Menu;\n","import React from 'react';\nimport {Router as ReachRouter} from '@reach/router';\nimport Convert from './pages/Convert';\nimport NotFound from './pages/NotFound';\nimport GlobalStateProvider from './contexts/Global';\nimport Global from './components/global/Global';\nimport Menu from './pages/Menu';\n\nconst Router: React.FC = () => {\n    return (\n        <GlobalStateProvider>\n            <ReachRouter>\n                <Menu path=\"/\" />\n                <Convert path=\"/convert\" />\n                <NotFound path=\"/*\" />\n            </ReachRouter>\n            <Global />\n        </GlobalStateProvider>\n    );\n};\n\nexport default Router;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Router from './Router';\nimport * as serviceWorker from './serviceWorker';\nimport './index.css';\n\nReactDOM.render(<Router />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n","import React, {createContext, useContext, useReducer, useRef} from \"react\";\n\nexport const colorPreferenceStyles = {\n    black: \"#000000\",\n    grey: \"#777777\",\n    red: \"#FF0000\",\n    orange: \"orange\",\n    yellow: \"#FFFF00\",\n    green: \"#00FF00\",\n    blue: \"#0000FF\",\n    purple: \"purple\"\n};\nexport const colorPreferenceOptions = Object.keys(\n    colorPreferenceStyles\n) as (keyof typeof colorPreferenceStyles)[];\nexport type colorPreferenceOption = (typeof colorPreferenceOptions)[number];\n\nexport const scalePreferenceOptions = ['small', 'medium', 'large'] as const;\nexport type scalePreferenceOption = (typeof scalePreferenceOptions)[number];\n\nexport const spacingPreferenceOptions = ['narrow', 'moderate', 'wide'] as const;\nexport type spacingPreferenceOption = (typeof spacingPreferenceOptions)[number];\n\nexport const noteHeadPreferenceOptions = [\"●\", \"◼\", \"▲\", \"▼\", \"○\", \"☐\", \"△\", \"▽\", \"⊗\", \"⊠\"] as const; // Previous symbols: ⨂, □\nexport type noteHeadPreferenceOption = (typeof noteHeadPreferenceOptions)[number];\n\nexport const clefPreferenceOptions = [\"WYSIWYP\",\"Traditional\"] as const;\nexport type clefPreferenceOptions = (typeof clefPreferenceOptions)[number];\n\nexport const measuresPerRowOptions = [1, 2, 3, 4, 5, 6] as const; // TODO: Consider using a slider\nexport type measuresPerRowOption = (typeof measuresPerRowOptions)[number];\n\nexport const accidentalTypeOptions = ['auto', 'sharp', 'flat'] as const;\nexport type accidentalTypeOption = (typeof accidentalTypeOptions)[number];\n\nexport type state = {\n    noteDurationColor: colorPreferenceOption;\n    noteSymbolColor: colorPreferenceOption;\n    staffScale: scalePreferenceOption;\n    horizontalSpacing: spacingPreferenceOption;\n    verticalSpacing: spacingPreferenceOption;\n    noteScale: scalePreferenceOption;\n    naturalNoteShape: noteHeadPreferenceOption,\n    sharpNoteShape: noteHeadPreferenceOption;\n    flatNoteShape: noteHeadPreferenceOption;\n    clefSymbols: clefPreferenceOptions;\n    measuresPerRow: measuresPerRowOption;\n    accidentalType: accidentalTypeOption\n};\nexport type action = {\n    type: \"set\";\n    val: Partial<state>;\n};\n\nlet initialState: state = {\n    noteDurationColor: \"grey\",\n    noteSymbolColor: \"black\",\n    staffScale: 'medium',\n    horizontalSpacing: 'moderate',\n    verticalSpacing: 'moderate',\n    noteScale: 'medium',\n    naturalNoteShape: '●',\n    sharpNoteShape: '▲',\n    flatNoteShape: '▼',\n    clefSymbols: 'WYSIWYP',\n    measuresPerRow: 4,\n    accidentalType: 'auto'\n};\n\nexport const PreferencesContext = createContext(undefined! as [\n    state,\n    React.Dispatch<action>\n]);\nexport const PreferencesStateProvider: React.FC<{}> = ({children}) => {\n    //we need to use a ref here to ensure that the same reducer is always used\n    let reducer = useRef(\n        (state: state, action: action): state => {\n            switch (action.type) {\n                case \"set\":\n                    return {...state, ...action.val};\n            }\n        }\n    );\n    let [state, dispatch] = useReducer(reducer.current, initialState);\n    return (\n        <PreferencesContext.Provider value={[state, dispatch]}>\n            {children}\n        </PreferencesContext.Provider>\n    );\n};\nexport const usePreferencesState = () => useContext(PreferencesContext);\n","\nexport function range(min: number, max: number){\n    let res: number[] = [];\n    for(let i = min; i < max; i++){\n        res.push(i);\n    }\n    return res;\n}\n","import React, {useEffect, useState, useRef} from 'react';\nimport {range} from '../util/Util';\n// import {Note} from '@tonejs/midi/dist/Note';\nimport MusicXML from 'musicxml-interfaces';\nimport {parse} from '../parser/MusicXML';\nimport {Note, Score, TimeSignature, KeySignature, StaffType} from '../parser/Types';\nimport {colorPreferenceStyles, usePreferencesState, spacingPreferenceOption, scalePreferenceOption} from '../contexts/Preferences';\nimport {useDialogState} from '../contexts/Dialog';\nimport * as Dialog from '../util/Dialog';\nimport {navigate} from '@reach/router';\n\ntype Props = {\n    xml: MusicXML.ScoreTimewise,\n    forcedWidth?: number,\n    editMode?: '' | 'fingerings',\n    editCallback?: () => void, //called when the xml is edited\n};\n\ntype Wedge = {\n    startMeasure: number,\n    startTime: number,\n    continuesFromLastRow: boolean,\n    type: 'crescendo' | 'diminuendo'\n} | undefined;\n\nenum Accidental {\n    Flat = -1,\n    Natural = 0,\n    Sharp = 1\n}\n\nconst SNView: React.FC<Props> = ({xml, forcedWidth, editMode = '', editCallback = () => {}}) => {\n    console.log(xml);\n    const ref = useRef(null! as HTMLDivElement);\n    let [width, setWidth] = useState<number | undefined>(undefined);\n    let [score, setScore] = useState<Score | undefined>(undefined);\n    let [preferences,] = usePreferencesState();\n\n    let [dialogState, setDialogState] = useDialogState();\n\n    let showError = (error: string) => {\n        setDialogState(Dialog.showMessage('An Error Occurred', error, 'Close', () => {\n            navigate('/');\n            setImmediate(() => setDialogState(Dialog.close()));\n        }));\n    };\n    let showErrorRef = useRef(showError);\n\n    console.log('Score:', score);\n    useEffect(() => {\n        if (forcedWidth === undefined) {\n            let width: number = undefined!;\n            let callback = () => {\n                let newWidth = ref.current!.getBoundingClientRect().width;\n                if (width !== newWidth) {\n                    width = newWidth;\n                    setWidth(newWidth);\n                }\n            };\n            window.addEventListener(\"resize\", callback);\n            // let interval = setInterval(callback, 20);\n            callback();\n            return () => {\n                window.removeEventListener(\"resize\", callback);\n                // clearInterval(interval);\n            };\n        } else {\n            setWidth(forcedWidth);\n        }\n    }, [setWidth, forcedWidth]);\n\n    useEffect(() => {\n        // parse only when page loads, xml changes, or an edit occurs\n        try {\n            setScore(parse(xml));\n        } catch (e) {\n            showErrorRef.current('An issue was encountered while processing this file.');\n            console.error(e);\n        }\n        // notify parent that xml has been modified so that it can be saved\n        editCallback();\n\n    }, [xml, (xml as any).revision]);\n\n    if (score === undefined || width === undefined) { //skip first render when width is unknown or parsing is incomplete\n        return <div ref={ref}></div>;\n    }\n\n    try {\n        let devMode = false;\n\n        // fetch preference values\n        let {\n            noteDurationColor,\n            noteSymbolColor,\n            staffScale,\n            horizontalSpacing,\n            verticalSpacing,\n            noteScale,\n            naturalNoteShape,\n            sharpNoteShape,\n            flatNoteShape,\n            measuresPerRow,\n            accidentalType\n        } = preferences;\n\n        // Map preference strings to numeric values\n        let noteScaleMap: Record<scalePreferenceOption, number> = {\n            small: 15,\n            medium: 20,\n            large: 25\n        };\n        let staffScaleMap: Record<scalePreferenceOption, number> = {\n            small: 18,\n            medium: 25,\n            large: 32\n        };\n        let verticalSpacingMap: Record<spacingPreferenceOption, number> = {\n            narrow: 10,\n            moderate: 30,\n            wide: 50\n        };\n        let horizontalSpacingMap: Record<spacingPreferenceOption, number> = {\n            narrow: 20,\n            moderate: 40,\n            wide: 60\n        };\n\n        //general spacing\n        let noteSymbolSize = noteScaleMap[noteScale]; //width/height of note symbols\n        let strokeWidth = 2;\n        let tickSize = 7;\n\n        //vertical spacing\n        let verticalPadding = 30; //top/bottom padding\n        let rowPadding = verticalSpacingMap[verticalSpacing]; //space between rows\n        let measureLabelSpace = 15; //space for measure labels\n\n        //horizontal spacing\n        let horizontalPadding = horizontalSpacingMap[horizontalSpacing]; //left/right padding\n        let staffLabelSpace = staffScaleMap[staffScale]; //space for staff labels\n        let octaveLabelSpace = measureLabelSpace; //space for octave labels\n        // let tieExtensionSpace = measureLabelSpace;\n\n        // composite horizontal spacing\n        let scoreWidth = width - 2 * horizontalPadding - staffLabelSpace - octaveLabelSpace; // width of just the WYSIWYP score\n        let beatWidth = scoreWidth / score.tracks[0].timeSignatures[0].beats / measuresPerRow;\n\n        // get key signature\n        let keyFifths = score.tracks[0].keySignatures[0].fifths;\n\n        // let octaveGroups = [1, 1, 0, 0, 0, 1, 1]; //octaveGroups (C D E / F G A B)\n        let staffLabels = preferences.clefSymbols === 'WYSIWYP' ? ['𝒯', 'ℬ'] : ['𝄞', '𝄢']; //𝄢\n        let octaveLines = [\n            {color: 'red', number: true}, undefined, undefined, /* C, D, E */\n            {color: 'blue'}, undefined, undefined, undefined, /* F, G, A, B */\n        ];\n        let accidentalMap = [0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0].map(x => x === 1); // C, C#, D, D#, E, ...\n        let noteMap = [0, 0, 1, 1, 2, 3, 3, 4, 4, 5, 5, 6];\n\n        let getNoteAccidental = (note: number): Accidental => {\n            return accidentalMap[note % 12] ? (keyFifths >= 0 ? Accidental.Sharp : Accidental.Flat) : Accidental.Natural;\n        };\n\n        // We map C0 (midi note 12) to line 0.\n        let getNoteLine = (note: number) => {\n            let line = Math.floor(note / 12 - 1) * 7 + noteMap[note % 12];\n\n            // if note is flat, we need to bring it a line higher.\n            if (accidentalType === 'auto' && getNoteAccidental(note) < 0) line++;\n            else if (accidentalType === 'flat' && getNoteAccidental(note) !== 0) line++; // handle user override\n\n            return line;\n        };\n\n        // find the title and author\n        let title = '';\n        try {\n            title = xml.movementTitle;\n            title = xml.work.workTitle;\n        } catch (e) {}\n\n        let findAuthor = (): string => {\n            // 1. check identification\n            if (xml.identification !== undefined && xml.identification.creators !== undefined) {\n                for (let creator of xml.identification.creators) {\n                    if (creator.type === 'composer') {\n                        return creator.creator;\n                    }\n                }\n            }\n\n            // 2. check credits\n            let author = '';\n            if (xml.credits !== undefined) {\n                let credits = xml.credits.filter(x => x.creditWords !== undefined && x.creditWords.length > 0).map(x => x.creditWords);\n                credits.forEach(credit => {\n                    credit.forEach(words => {\n                        if (Math.abs(words.words.length - 20) < Math.abs(author.length - 20)) {\n                            author = words.words;\n                        }\n                    });\n                });\n            }\n            return author;\n        };\n\n        let author = findAuthor();\n\n        let minNote: Record<StaffType, number> = {\n            treble: 128,\n            bass: 128\n        };\n\n        let maxNote: Record<StaffType, number> = {\n            treble: -1,\n            bass: -1\n        };\n\n        //calculate lowest and highest note\n        let instrumentTrack = score.tracks.filter(track => track.trackTypes.includes('instrument'))[0];\n        instrumentTrack.measures.forEach(measure => {\n            measure.forEach(note => {\n                minNote[note.staff] = Math.min(minNote[note.staff], note.midi);\n                maxNote[note.staff] = Math.max(maxNote[note.staff], note.midi);\n            });\n        });\n\n        let staffTypes: StaffType[] = ['treble', 'bass'];\n\n        // if bass clef is empty, then we create an empty clef\n        let bassClefIsEmpty = false;\n        if (minNote.bass === 128 && maxNote.bass === -1) {\n            bassClefIsEmpty = true;\n            minNote.bass = 48;\n            maxNote.bass = 60;\n        }\n\n        staffTypes.forEach(staff => {\n            if (minNote[staff] >= 128 || minNote[staff] < 0 || maxNote[staff] >= 128 || maxNote[staff] < 0) {\n                console.log(minNote[staff], maxNote[staff]);\n                throw new Error('An issue was detected while analyzing this work\\'s note range');\n            }\n        });\n\n        //calculate the height of each row (based upon low/high notes and oct groups)\n        let minLine: Record<StaffType, number> = {\n            treble: getNoteLine(minNote.treble),\n            bass: getNoteLine(minNote.bass)\n        };\n        let maxLine: Record<StaffType, number> = {\n            treble: getNoteLine(maxNote.treble),\n            bass: getNoteLine(maxNote.bass)\n        };\n\n        staffTypes.forEach(staff => {\n            // find the closest note line\n            while (minLine[staff] % 7 !== 0 && minLine[staff] % 7 !== 3) minLine[staff]--;\n            while (maxLine[staff] % 7 !== 0 && maxLine[staff] % 7 !== 3) maxLine[staff]++;\n\n            // widen staff range if it is too small\n            if (Math.abs(maxLine[staff] - minLine[staff]) <= 1) {\n                maxLine[staff] += (maxLine[staff] % 7 === 0) ? 3 : 4;\n                minLine[staff] -= (minLine[staff] % 7 === 0) ? 4 : 3;\n            }\n        });\n        let staffHeights: Record<StaffType, number> = {\n            treble: (maxLine.treble - minLine.treble) * noteSymbolSize / 2,\n            bass: (maxLine.bass - minLine.bass) * noteSymbolSize / 2\n        };\n\n        //calculate the number of beats per measure\n        let beatsPerMeasure = score.tracks[0].timeSignatures[0].beats;\n        let measureWidth = beatWidth * beatsPerMeasure;\n\n        //calculate tne number of measures per row\n        let availableMeasureSpace = width - horizontalPadding * 2 - staffLabelSpace - octaveLabelSpace;\n        horizontalPadding += (availableMeasureSpace - measuresPerRow * measureWidth) / 2; //update horizontal padding to center rows\n\n        //calculate the number of rows\n        let measureNumber = score.tracks.reduce((accum, track) => Math.max(accum, track.measures.length), 0);\n        if (measureNumber <= 0) {\n            throw new Error('Failed to identify number of measures');\n        }\n        let rowNumber = Math.ceil(measureNumber / measuresPerRow);\n\n        // set up wedge (crescendo / diminuendo) tracking\n        let currentWedge: Wedge;\n        let key = 0; // keys for JSX elements\n\n        let getCurrentSignatures = (measureNumber: number): {currentTime: TimeSignature, currentKey: KeySignature} => {\n            let timeSignatures = [...score!.tracks[0].timeSignatures].reverse(); // we reverse the array because we want to find the latest key signature.\n            let keySignatures = [...score!.tracks[0].keySignatures].reverse();\n\n            let currentTime = timeSignatures.find(timeSignature => timeSignature.measure <= measureNumber);\n            let currentKey = keySignatures.find(keySignature => keySignature.measure <= measureNumber);\n\n            // sometimes, signatures are defined on the second measure. Below lines handle such cases.\n            if (!currentTime) currentTime = score!.tracks[0].timeSignatures[0];\n            if (!currentKey) currentKey = score!.tracks[0].keySignatures[0];\n            return {currentTime, currentKey};\n        };\n\n        let grandStaff = (i: number): JSX.Element => {\n            return (\n                <div className={`snview-row snview-row-${i + 1}`} key={i} style={{position: 'relative', height: 'auto', paddingTop: `${rowPadding}px`}}>\n                    {staff(i, 'treble')}\n                    {staffBreak(i)} {/* information that goes between two staffs */}\n                    {staff(i, 'bass')}\n                    {pedal(i)}\n                </div>\n            );\n        };\n\n        let staff = (i: number, staff: StaffType): JSX.Element | null => {\n            if (bassClefIsEmpty && staff === 'bass') return null;\n\n            let staffHeight = staffHeights[staff];\n            let svgHeight = staffHeight + measureLabelSpace + noteSymbolSize / 2;\n            let staffName = (staff === 'treble' && !instrumentTrack.bassStaffOnly) ? staffLabels[0] : staffLabels[1];\n\n            return <div style={{position: 'relative', height: 'auto'}}>\n                <svg viewBox={`0 0 ${width} ${svgHeight}`}>\n                    <g transform={`translate(${horizontalPadding}, 0)`}>\n                        <text x={staffLabelSpace} y={measureLabelSpace + staffHeight / 2} fontSize={staffLabelSpace * 1.5} textAnchor=\"end\" dominantBaseline=\"middle\">{staffName}</text>\n                        <rect x={staffLabelSpace + octaveLabelSpace - strokeWidth / 2} y={measureLabelSpace - strokeWidth / 2} width={strokeWidth} height={staffHeight + strokeWidth} fill=\"#000000\" />\n\n                        {range(0, i < rowNumber - 1 ? measuresPerRow : measureNumber - (rowNumber - 1) * measuresPerRow).map(j =>\n                            measure(staffLabelSpace + octaveLabelSpace + j * measureWidth, 0, i * measuresPerRow + j, staff)\n                        )}\n                    </g>\n                </svg>\n            </div>;\n        };\n\n        let measureNumberToPos = (measureNumber: number): number => {\n            return strokeWidth + horizontalPadding + staffLabelSpace + octaveLabelSpace + measureNumber * measureWidth;\n        };\n\n        let drawWedge = (height: number, endTime: number, measureNumber: number, continuesToNextRow: boolean): JSX.Element[] => {\n            let {startMeasure, startTime, continuesFromLastRow, type} = currentWedge!;\n            let startX = measureNumberToPos(startMeasure) + noteTimeToPos(startTime, 'treble').x;\n            let endX = measureNumberToPos(measureNumber) + noteTimeToPos(endTime, 'treble').x;\n            if (startX === endX) endX += noteSymbolSize;\n\n            // TODO: consider comining the below logic\n            if (type === 'crescendo' && continuesFromLastRow) {\n                return [\n                    <line key={key++}\n                        x1={startX + strokeWidth} x2={endX - strokeWidth}\n                        y1={height / 3} y2={strokeWidth}\n                        strokeWidth={strokeWidth} stroke='black'\n                    />,\n                    <line key={key++}\n                        x1={startX + strokeWidth} x2={endX - strokeWidth}\n                        y1={height * 2 / 3} y2={height - strokeWidth}\n                        strokeWidth={strokeWidth} stroke='black'\n                    />\n                ];\n            } else if (type === 'diminuendo' && continuesToNextRow) {\n                return [\n                    <line key={key++}\n                        x1={startX + strokeWidth} x2={endX - strokeWidth}\n                        y1={strokeWidth} y2={height / 3}\n                        strokeWidth={strokeWidth} stroke='black'\n                    />,\n                    <line key={key++}\n                        x1={startX + strokeWidth} x2={endX - strokeWidth}\n                        y1={height - strokeWidth} y2={height * 2 / 3}\n                        strokeWidth={strokeWidth} stroke='black'\n                    />\n                ];\n            } else {\n                return [\n                    <line key={key++}\n                        x1={startX + strokeWidth} x2={endX - strokeWidth}\n                        y1={type === 'crescendo' ? height / 2 : strokeWidth} y2={type === 'crescendo' ? strokeWidth : height / 2}\n                        strokeWidth={strokeWidth} stroke='black'\n                    />,\n                    <line key={key++}\n                        x1={startX + strokeWidth} x2={endX - strokeWidth}\n                        y1={type === 'crescendo' ? height / 2 : height - strokeWidth} y2={type === 'crescendo' ? height - strokeWidth : height / 2}\n                        strokeWidth={strokeWidth} stroke='black'\n                    />\n                ];\n            }\n        };\n\n        let staffBreak = (i: number): JSX.Element | null => {\n            // general spacing\n            let textSize = noteSymbolSize * 6 / 7;\n\n            // vertical spacing\n            let lyricsSpace = noteSymbolSize * 1.5;\n            let dynamicsSpace = noteSymbolSize * 1;\n            let margin = 10;\n\n            // get respective directions and notes\n            let directionsAtRow = instrumentTrack.directions.slice(i * measuresPerRow, (i + 1) * measuresPerRow);\n            let dynamicsAreEmpty = currentWedge === undefined && directionsAtRow.every(directions =>\n                directions.length === 0 || directions.every(direction => direction.dynamics === undefined && direction.wedge === undefined)\n            );\n\n            let lyrics: JSX.Element[] = [];\n            let lyricsTrack = score!.tracks.find(track => track.trackTypes.includes('lyrics'));\n            if (lyricsTrack === undefined) return null;\n\n            let notesAtRow = lyricsTrack.measures.slice(i * measuresPerRow, (i + 1) * measuresPerRow);\n            let lyricsAreEmpty = notesAtRow.every(measure => measure.length === 0);\n\n            // 1. render dynamics\n            let dynamics: JSX.Element[] = [];\n\n            directionsAtRow.forEach((directionsAtMeasure, measureNumber) => {\n                directionsAtMeasure.forEach(direction => {\n                    if (direction.dynamics === undefined) return;\n                    let x = measureNumberToPos(measureNumber) + noteTimeToPos(direction.time, 'treble').x;\n                    let y = dynamicsSpace * 6 / 7;\n                    dynamics.push(\n                        <text x={x} y={y} fontWeight='bold' fontFamily='monospace' fontStyle='italic' key={key++} fontSize={textSize}>\n                            {direction.dynamics}\n                        </text>\n                    );\n                });\n            });\n\n            // 2. render wedges\n            directionsAtRow.forEach((directionsAtMeasure, measureNumber) => {\n                directionsAtMeasure.forEach(direction => {\n                    if (direction.wedge === undefined) return;\n                    if (direction.wedge === 'crescendo' || direction.wedge === 'diminuendo') {\n                        currentWedge = {\n                            startMeasure: /* i * measuresPerRow */ + measureNumber,\n                            startTime: direction.time,\n                            continuesFromLastRow: false,\n                            type: direction.wedge,\n                        };\n                    } else if (direction.wedge === 'stop') {\n                        // draw wedge\n                        dynamics.push(...drawWedge(dynamicsSpace, direction.time, measureNumber, false));\n                        currentWedge = undefined; // finish this wedge\n                    }\n                });\n            });\n\n            // check if current wedge spans then next row\n            if (currentWedge !== undefined) {\n                // draw wedge for this row (ending at the last measure)\n                dynamics.push(...drawWedge(dynamicsSpace, beatsPerMeasure, measuresPerRow - 1, true));\n                // split off the remaining wedge\n                currentWedge.startMeasure = currentWedge.startTime = 0;\n                currentWedge.continuesFromLastRow = true;\n            }\n\n            // 3. render lyrics\n            notesAtRow.forEach((notesAtMeasure, measureNumber) => {\n                notesAtMeasure.forEach(note => {\n                    if (!note.attributes.lyrics) return;\n                    let x = measureNumberToPos(measureNumber) + noteTimeToPos(note.time, 'treble').x;\n\n                    let y = lyricsSpace * 6 / 7; // multiply by 6 / 7 so that text render in the middle and not the bottom\n                    if (!dynamicsAreEmpty) y += margin + dynamicsSpace; // if there are dynamics, then we render lyrics below dynamics\n\n                    lyrics.push(\n                        <text x={x} y={y} key={key++} fontSize={textSize}>\n                            {note.attributes.lyrics}\n                        </text>\n                    );\n                });\n            });\n\n            let svgHeight = 0;\n            // fit svg height to contents\n            if (!dynamicsAreEmpty) svgHeight += dynamicsSpace;\n            if (!lyricsAreEmpty) svgHeight += lyricsSpace;\n            if (!lyricsAreEmpty && !dynamicsAreEmpty) svgHeight += margin;\n\n            let contentSVG = dynamicsAreEmpty && lyricsAreEmpty ? null : (\n                <svg viewBox={`0 0 ${width} ${svgHeight}`}>\n                    {dynamics}\n                    {lyrics}\n                </svg>\n            ); // don't render svg if empty\n\n            return (\n                <div style={{position: 'relative', height: 'auto', marginBottom: '10px'}}>\n                    {contentSVG}\n                </div>\n            );\n        };\n\n        let pedal = (i: number) => {\n            let pedals: JSX.Element[] = [];\n            let instrumentTrack = score!.tracks.find(track => track.trackTypes.includes('instrument'));\n            if (!instrumentTrack) return null;\n\n            let directionsAtRow = instrumentTrack.directions.slice(i * measuresPerRow, (i + 1) * measuresPerRow);\n            let directionsAreEmpty = directionsAtRow.every(directions => directions.length === 0);\n            if (bassClefIsEmpty && directionsAreEmpty) return null;\n\n            directionsAtRow.forEach((directionsAtMeasure, measureNumber) => {\n                directionsAtMeasure.forEach(direction => {\n                    if (!direction.pedal) return;\n                    let pedalText = direction.pedal === 'start' ? '𝒫𝑒𝒹.' : '✻';\n                    let x = measureNumberToPos(measureNumber) + noteTimeToPos(direction.time, 'treble').x;\n                    pedals.push(\n                        <text x={`${x}`} y={noteSymbolSize} key={key++} fontSize={noteSymbolSize} fontWeight='bold'>\n                            {pedalText}\n                        </text>\n                    );\n                });\n            });\n\n            return (\n                <div style={{position: 'relative', height: 'auto'}}>\n                    <svg viewBox={`0 0 ${width} ${2 * noteSymbolSize}`}>\n                        {pedals}\n                    </svg>\n                </div>\n            );\n        };\n\n        let measure = (x: number, y: number, measureNumber: number, staff: StaffType) => {\n            // Get time signature of current measure\n            let {currentTime, currentKey} = getCurrentSignatures(measureNumber);\n            beatWidth = scoreWidth / currentTime.beats / measuresPerRow;\n            beatsPerMeasure = currentTime.beats;\n            keyFifths = currentKey!.fifths;\n\n            // Draw measure\n            let measureSVG: JSX.Element[] = [];\n            measureSVG.push(<rect key={key++} x={measureWidth - strokeWidth / 2} y={measureLabelSpace - strokeWidth / 2} width={strokeWidth} height={staffHeights[staff] + strokeWidth} fill=\"#000000\" />);\n            for (let j = minLine[staff]; j <= maxLine[staff]; j++) {\n                let octaveLine = octaveLines[j % 7];\n                if (octaveLine !== undefined) {\n                    let lineY = measureLabelSpace + staffHeights[staff] - (j - minLine[staff]) * noteSymbolSize / 2;\n                    measureSVG.push(<rect key={key++} x={strokeWidth / 2} y={lineY - strokeWidth / 2} width={measureWidth - strokeWidth} height={strokeWidth} fill={octaveLine.color} />);\n                    if (measureNumber % measuresPerRow === 0 && octaveLine.number === true) {\n                        measureSVG.push(<text x={-strokeWidth} key={key++} y={lineY} fontSize={measureLabelSpace} textAnchor=\"end\" dominantBaseline=\"middle\">{Math.floor(j / 7)}</text>);\n                    }\n                    if (j < maxLine[staff]) {\n                        for (let measureNumber = 1; measureNumber < beatsPerMeasure; measureNumber++) {\n                            let tickX = measureWidth / beatsPerMeasure * measureNumber;\n                            measureSVG.push(<rect key={key++} x={tickX - strokeWidth / 2} y={lineY - tickSize} width={strokeWidth} height={tickSize - strokeWidth / 2} fill=\"#000000\" />);\n                        }\n                    }\n                }\n            }\n\n            // Add notes to the measure\n            const noteHeadSVG: JSX.Element[] = [];\n            const noteTailSVG: JSX.Element[] = [];\n            score!.tracks.forEach(track => {\n                if (!track.trackTypes.includes('instrument')) return; // we do not render notes for lyrics only track.\n                let notes = track.measures[measureNumber].filter(note => note.staff === staff);\n                notes.forEach((note, _idx) => {\n                    noteHeadSVG.push(noteHead(note, key++, staff));\n\n                    let tieStart = note.attributes.tie !== undefined && note.attributes.tie === 'start';\n                    let tieStop = note.attributes.tie !== undefined && note.attributes.tie === 'end';\n\n                    let isLastMeasure = ((measureNumber + 1) % measuresPerRow === 0); // whether current measure is the last measure of the row\n                    let isLastNote = note.time + note.duration >= currentTime.beats; // whether the note reaches the end of the measure\n                    let noteSpansRow = tieStart && isLastMeasure && isLastNote; // whether tied note spans next row\n\n                    noteTailSVG.push(noteTail(note, key++, tieStart, tieStop, noteSpansRow, staff));\n                });\n            });\n\n            return (\n                <g id={`measure${measureNumber + 1}`} key={measureNumber} transform={`translate(${x}, ${y})`}>\n                    <g id='frame'>\n                        {devMode ? <rect width={measureWidth} height={measureLabelSpace - strokeWidth / 2} fill=\"#ffdddd\" /> : null}\n                        <text x={strokeWidth} y={measureLabelSpace - strokeWidth} fontSize={measureLabelSpace}>{measureNumber + 1}</text>\n                        {measureSVG}\n                    </g>\n                    <g id='notes'>\n                        {noteTailSVG}\n                        {noteHeadSVG}\n                    </g>\n                </g>\n            );\n        };\n\n        let noteTimeToPos = (noteTime: number, staff: StaffType) => ({\n            x: beatWidth * noteTime,\n            y: staffHeights[staff] + measureLabelSpace\n        });\n\n        let noteTail = (note: Note, i: number, tieStart: boolean, tieStop: boolean, noteSpansRow: boolean, staff: StaffType) => {\n            let boxes: JSX.Element[] = [];\n\n            let line = getNoteLine(note.midi) - minLine[staff];\n            let {x: xStart, y: yStart} = noteTimeToPos(note.time, staff);\n            let {x: xEnd} = noteTimeToPos(note.time + note.duration, staff);\n\n            let roundingSpace = Math.max(Math.min(noteSymbolSize, xEnd - xStart), 0);\n            let radiusStart = tieStop ? 0 : roundingSpace / 4;\n            let radiusEnd = tieStart ? 0 : roundingSpace / 2;\n            let pointedEnd = noteSpansRow;\n\n            boxes.push(\n                <path\n                    key={key++}\n                    d={`\n                        M${xStart + radiusStart} ${yStart - (line + 1) * noteSymbolSize / 2}\n                        H${xEnd - radiusEnd}\n                        ${pointedEnd ? `l` : `a${radiusEnd} ${radiusEnd} 0 0 ${noteSpansRow ? 0 : 1} `}${radiusEnd} ${radiusEnd}\n                        ${pointedEnd ? `\n                            l${noteSymbolSize / 2 - radiusEnd} ${noteSymbolSize / 2 - radiusEnd}\n                            l${-noteSymbolSize / 2 + radiusEnd} ${noteSymbolSize / 2 - radiusEnd}\n                        `: `v${noteSymbolSize - 2 * radiusEnd}`}\n                        ${pointedEnd ? `l` : `a${radiusEnd} ${radiusEnd} 0 0 ${noteSpansRow ? 0 : 1} `}${-radiusEnd} ${radiusEnd}\n                        H${xStart + radiusStart}\n                        a${radiusStart} ${radiusStart} 0 0 1 ${-radiusStart} ${-radiusStart}\n                        v${-noteSymbolSize + 2 * radiusStart}\n                        a${radiusStart} ${radiusStart} 0 0 1 ${radiusStart} ${-radiusStart}\n                        z\n                    `}\n                    fill={colorPreferenceStyles[noteDurationColor]}\n                    fillOpacity={0.5}\n                />\n            );\n\n            return (\n                <React.Fragment key={i}>\n                    {boxes}\n                </React.Fragment>\n            );\n        };\n\n        let noteHead = (note: Note, i: number, staff: StaffType) => {\n            if (note.attributes.tie !== undefined && note.attributes.tie === 'end')\n                return null!;\n            let accidental: Accidental = getNoteAccidental(note.midi);\n            let line = getNoteLine(note.midi) - minLine[staff];\n\n            let {x, y} = noteTimeToPos(note.time, staff);\n\n            x += noteSymbolSize / 2;\n            y -= line * noteSymbolSize / 2;\n            let triHeight = noteSymbolSize * Math.sqrt(3) / 2;\n\n            let strokeWidth = noteSymbolSize / 8;\n            let crossCircleWidth = noteSymbolSize / 2 / Math.sqrt(2);\n\n            let autoNoteShape = accidentalType === 'sharp' ? sharpNoteShape : flatNoteShape;\n            let shape = {\n                [Accidental.Natural]: naturalNoteShape,\n                [Accidental.Flat]: accidentalType === 'auto' ? flatNoteShape : autoNoteShape,\n                [Accidental.Sharp]: accidentalType === 'auto' ? sharpNoteShape : autoNoteShape,\n            }[accidental];\n\n            let callback = () => {\n                if (editMode === 'fingerings') {\n                    setDialogState(Dialog.showMessage('Edit Fingering', <>\n                        Value:&emsp;<select style={{backgroundColor: 'rgb(221,221,221)'}} defaultValue={`${note.fingering}`} onChange={\n                            (e) => {\n                                note.setFingering(parseFloat(e.target.value));\n                            }\n                        }>{['', '1', '2', '3', '4', '5'].map(x => <option key={x}>{x}</option>)}</select>\n                    </>, 'Done', () => {\n                        setDialogState(Dialog.close());\n                    }));\n                }\n            };\n\n            let notehead: any;\n            switch (shape) {\n                case '●':\n                    notehead = <circle cx={x} cy={y} r={noteSymbolSize / 2} fill={colorPreferenceStyles[noteSymbolColor]} />;\n                    break;\n                case '◼':\n                    notehead = <rect x={x - noteSymbolSize / 2 + strokeWidth / 2} y={y - noteSymbolSize / 2 + strokeWidth / 2} width={noteSymbolSize - strokeWidth} height={noteSymbolSize - strokeWidth} fill={colorPreferenceStyles[noteSymbolColor]} />;\n                    break;\n                case '▲':\n                    notehead = <polygon points={`${x},${y - triHeight / 2} ${x + noteSymbolSize / 2},${y + triHeight / 2} ${x - noteSymbolSize / 2},${y + triHeight / 2}`} fill={colorPreferenceStyles[noteSymbolColor]} />;\n                    break;\n                case '▼':\n                    notehead = <polygon points={`${x},${y + triHeight / 2} ${x + noteSymbolSize / 2},${y - triHeight / 2} ${x - noteSymbolSize / 2},${y - triHeight / 2}`} fill={colorPreferenceStyles[noteSymbolColor]} />;\n                    break;\n                case '○':\n                    notehead = <circle cx={x} cy={y} r={(noteSymbolSize - strokeWidth) / 2} strokeWidth={strokeWidth} stroke={colorPreferenceStyles[noteSymbolColor]} fill='none' />;\n                    break;\n                case '☐':\n                    notehead = <rect x={x - noteSymbolSize / 2 + strokeWidth / 2} y={y - noteSymbolSize / 2 + strokeWidth / 2} width={noteSymbolSize - strokeWidth} height={noteSymbolSize - strokeWidth} stroke={colorPreferenceStyles[noteSymbolColor]} strokeWidth={strokeWidth} fill='none' />;\n                    break;\n                case '△':\n                    notehead = <polygon points={`${x},${y - triHeight / 2 + strokeWidth} ${x + noteSymbolSize / 2 - Math.sqrt(3) * strokeWidth / 2},${y + triHeight / 2 - strokeWidth / 2} ${x - noteSymbolSize / 2 + Math.sqrt(3) * strokeWidth / 2},${y + triHeight / 2 - strokeWidth / 2}`} stroke={colorPreferenceStyles[noteSymbolColor]} strokeWidth={strokeWidth} fill='none' />;\n                    break;\n                case '▽':\n                    notehead = <polygon points={`${x},${y + triHeight / 2 - strokeWidth} ${x + noteSymbolSize / 2 - Math.sqrt(3) * strokeWidth / 2},${y - triHeight / 2 + strokeWidth / 2} ${x - noteSymbolSize / 2 + Math.sqrt(3) * strokeWidth / 2},${y - triHeight / 2 + strokeWidth / 2}`} stroke={colorPreferenceStyles[noteSymbolColor]} strokeWidth={strokeWidth} fill='none' />;\n                    break;\n                case '⊗':\n                    notehead = (<g>\n                        <circle cx={x} cy={y} r={(noteSymbolSize - 2) / 2} strokeWidth={strokeWidth} stroke={colorPreferenceStyles[noteSymbolColor]} fill='none' />;\n                        <line x1={x - crossCircleWidth} y1={y - crossCircleWidth} x2={x + crossCircleWidth} y2={y + crossCircleWidth} stroke={colorPreferenceStyles[noteSymbolColor]} strokeWidth={strokeWidth} />\n                        <line x1={x - crossCircleWidth} y1={y + crossCircleWidth} x2={x + crossCircleWidth} y2={y - crossCircleWidth} stroke={colorPreferenceStyles[noteSymbolColor]} strokeWidth={strokeWidth} />\n                    </g>);\n                    break;\n                case '⊠':\n                    notehead = (<g>\n                        <rect x={x - noteSymbolSize / 2 + strokeWidth / 2} y={y - noteSymbolSize / 2 + strokeWidth / 2} width={noteSymbolSize - strokeWidth} height={noteSymbolSize - strokeWidth} stroke={colorPreferenceStyles[noteSymbolColor]} strokeWidth={strokeWidth} fill='none' />\n                        <line x1={x - noteSymbolSize / 2 + strokeWidth / 2} y1={y - noteSymbolSize / 2 + strokeWidth / 2} x2={x + noteSymbolSize / 2 - strokeWidth / 2} y2={y + noteSymbolSize / 2 - strokeWidth / 2} stroke={colorPreferenceStyles[noteSymbolColor]} strokeWidth={strokeWidth} />\n                        <line x1={x - noteSymbolSize / 2 + strokeWidth / 2} y1={y + noteSymbolSize / 2 - strokeWidth / 2} x2={x + noteSymbolSize / 2 - strokeWidth / 2} y2={y - noteSymbolSize / 2 + strokeWidth / 2} stroke={colorPreferenceStyles[noteSymbolColor]} strokeWidth={strokeWidth} />\n                    </g>);\n                    break;\n            }\n\n            return <g onClick={callback} key={i}>\n                <text x={x} y={y - noteSymbolSize / 2 - strokeWidth / 2} fontSize={10} textAnchor=\"middle\" alignmentBaseline=\"baseline\">{note.fingering}</text>\n                {notehead}\n            </g>;\n        };\n\n        let svgRows: JSX.Element[] = range(0, rowNumber).map(i => grandStaff(i));\n        let titleRowHeight = 130;\n        return (\n            <div id=\"snview\" ref={ref} style={{width: '100%', height: 'auto', overflow: 'hidden', minWidth: '350px', userSelect: 'text', paddingTop: verticalPadding, paddingBottom: verticalPadding}}>\n                <div className={`snview-row snview-row-0`} style={{position: 'relative', height: 'auto'}}>\n                    <div style={{position: 'relative', height: 'auto'}}>\n                        <svg viewBox={`0 0 ${width} ${titleRowHeight}`}>\n                            <text x={width / 2} y={10} fontSize={40} textAnchor=\"middle\" alignmentBaseline=\"hanging\">{title}</text>\n                            <text x={70} y={titleRowHeight - 10} fontSize={25} textAnchor=\"start\">{score.tempo ? `${score.tempo} bpm` : null}</text>\n                            <text x={width - 70} y={titleRowHeight - 10} fontSize={25} textAnchor=\"end\">{author}</text>\n                        </svg>\n                    </div>\n                </div>\n                {svgRows}\n            </div>\n        );\n    } catch (e) {\n        console.error(e);\n        if (!dialogState.shown) {\n            showError('An issue was encountered while generating WYSIWYP output for the selected file.');\n        }\n        return <div ref={ref}></div>;\n    }\n};\n\nexport default SNView;\n","import React, {CSSProperties} from \"react\";\nimport {action as DialogAction} from '../contexts/Dialog';\n\nexport const close = ()=>{\n    return {type: 'close'} as DialogAction;\n};\n\nexport const showMessage = (title: string, body: any, buttonText: string, buttonAction: ()=>void): DialogAction =>{\n    return {type: 'open', val: {title, width: 400, height: 275, contents: <div style={styles.body}>\n        <div style={styles.space} />\n        <div style={styles.top}>\n            {body}\n        </div>\n        <div style={styles.space} />\n        <div style={styles.bottom}>\n            <span style={styles.link} onClick={buttonAction}>\n                {buttonText}\n            </span>\n        </div>\n    </div>}};\n};\n\nexport const showPrompt = (title: string, body: any, buttonText1: string, buttonAction1: () => void, buttonText2: string, buttonAction2: () => void): DialogAction => {\n    return {\n        type: 'open', val: {\n            title, width: 400, height: 275, contents: <div style={styles.body}>\n                <div style={styles.space} />\n                <div style={styles.top}>\n                    {body}\n                </div>\n                <div style={styles.space} />\n                <div style={styles.bottom}>\n                    <span style={styles.link} onClick={buttonAction1}>\n                        {buttonText1}\n                    </span>\n                    <span style={{...styles.link,color:'indianred'}} onClick={buttonAction2}>\n                        {buttonText2}\n                    </span>\n                </div>\n            </div>\n        }\n    };\n};\n\nconst styleMap = {\n    body: {\n        display: 'flex',\n        flexDirection: 'column',\n    },\n    top: {\n        position: 'initial',\n        top: 'auto',\n        left: 'auto',\n        height: 'auto',\n        fontSize: '20px',\n        textAlign: 'center',\n        flex: '0 1 auto',\n        padding: '30px',\n        overflowX: 'hidden',\n        overflowY: 'auto',\n    },\n    bottom: {\n        position: 'initial',\n        top: 'auto',\n        left: 'auto',\n        height: 'auto',\n        textAlign: 'center',\n        flex: '0 0 auto',\n        paddingBottom: '20px',\n    },\n    space: {\n        position: 'initial',\n        top: 'auto',\n        left: 'auto',\n        height: 'auto',\n        flex: '1 0 auto',\n    },\n    link: {\n        color: '#31B7D6',\n        cursor: 'pointer',\n        fontSize: '28px',\n        fontWeight: 'bold',\n        padding:'0 30px',\n    }\n} as const;\nconst styles: Record<keyof typeof styleMap, CSSProperties> = styleMap;\n","module.exports = __webpack_public_path__ + \"static/media/upload.027829c2.svg\";","/**\n * This file contains types used for the MusicXML parser.\n */\n\n// Track and staff types\nexport type TrackType = 'instrument' | 'lyrics'; // part types that app currently handles\nexport type StaffType = 'treble' | 'bass';\n\n// Directions\nconst dynamicsArray = ['f', 'ff', 'fff', 'ffff', 'ffff', 'ffffff', 'fp', 'fz', 'mf', 'mp', 'p', 'pp', 'ppp', 'pppp', 'ppppp', 'pppppp', 'rf', 'rfz', 'sf', 'sffz', 'sfp', 'sfpp', 'sfz'] as const;\nexport type Dynamics = (typeof dynamicsArray)[number];\nexport let isDynamics = ((str: string): str is Dynamics => dynamicsArray.some(dynamic => dynamic === str));\n\nexport type Pedal = 'start' | 'end';\n\nexport type Wedge = 'crescendo' | 'diminuendo' | 'stop';\n\nexport type Direction = {\n    dynamics?: Dynamics,\n    pedal?: Pedal,\n    wedge?: Wedge,\n    time: number\n}; // Directions are used for expression marks that are not tied to a particular note.\n\nexport type Directions = Direction[];\n\n// Note attributes\nexport type Tie = 'start' | 'end';\n\nexport type Slur = 'start' | 'end';\n\n// Notes\nexport type Note = {\n    time: number,\n    duration: number,\n    midi: number,\n    fingering: string,\n    setFingering: (x: number) => void,\n    staff: StaffType,\n    attributes: {\n        tie?: Tie,\n        slur?: Slur,\n        lyrics?: string\n    }\n};\nexport type Notes = Note[];\n\n// Signatures\nexport type TimeSignature = {\n    measure: number,\n    beats: number,\n    beatTypes: number,\n};\n\nexport type KeySignature = {\n    measure: number,\n    fifths: number\n};\n\n// Tracks and scores\nexport type Track = {\n    measures: Notes[],\n    directions: Directions[]\n    timeSignatures: TimeSignature[],\n    keySignatures: KeySignature[],\n    trackTypes: TrackType[], // we use an array here because a track might contain both lyrics and piano part.\n    bassStaffOnly?: boolean // whether the piece only has a bass staff\n};\n\nexport type Tracks = Track[];\n\nexport type Score = {\n    tracks: Tracks,\n    tempo?: number\n};\n","import MusicXML from 'musicxml-interfaces';\nimport {Note, TimeSignature, KeySignature, Tracks, Score, Notes, Track, TrackType, isDynamics, Direction, Directions, Slur} from './Types';\n\nconst pitchToMidi = (pitch: {octave: number, step: string, alter?: number}) => {\n    // we assume C4 = 60 as middle C. Note that typical 88-key piano contains notes from A0 (21) - C8 (108).\n    let step = ({c: 0, d: 2, e: 4, f: 5, g: 7, a: 9, b: 11} as {[index: string]: number})[pitch.step.toLowerCase()];\n    return (pitch.octave + 1) * 12 + step + (pitch.alter === undefined ? 0 : Math.round(pitch.alter));\n};\n\nconst isScorePart = (part: MusicXML.PartGroup | MusicXML.ScorePart): part is MusicXML.ScorePart => {\n    return part && part._class === 'ScorePart';\n};\n\n// get piano part name from xml\nconst getPianoPartID = (xml: MusicXML.ScoreTimewise): string | undefined => {\n    const pianoPart = xml.partList.find(part => isScorePart(part) && part.partName.partName.toLowerCase() === 'piano');\n    return pianoPart ? (pianoPart as MusicXML.ScorePart).id : undefined;\n};\n\nconst getLyricsPartID = (xml: MusicXML.ScoreTimewise): string | undefined => {\n    let lyricsPartId: string | undefined;\n    // loop until we find a part with some lyrics defined.\n    xml.measures.some(measure => {\n        return Object.keys(measure.parts).some(partName => {\n            let part = measure.parts[partName];\n            let partContainsLyrics = part.some(entry => entry.lyrics !== undefined);\n            lyricsPartId = partContainsLyrics ? partName : undefined;\n            return lyricsPartId !== undefined;\n        });\n    });\n    return lyricsPartId;\n};\n\nexport const parse = (xml: MusicXML.ScoreTimewise): Score => {\n    let lyricsPartId = getLyricsPartID(xml);\n    let pianoPartId = getPianoPartID(xml);\n\n    // currently, SNApp renders piano and lyric parts. We store the ids of the tracks we have to parse below.\n    let tempo: number | undefined;\n\n    let currentBeatType = 4;\n    let currentBeats = 4;\n    let parts: {\n        [index: string]: {\n            divisions: number,\n            progress: number,\n            timeSignatures: TimeSignature[];\n            keySignatures: KeySignature[];\n            measures: Notes[],\n            directions: Directions[]\n        }\n    } = {};\n\n    /**\n     * Multitrack Handling Logic\n     *\n     * We parse:\n     *      1) just the instrument part from a two part work for instrument and vocal\n     *      2) just the piano part from a work with multiple instrument parts\n     *      3) just one instrument part from a work with multiple instruments and none of them are piano\n     */\n\n    // parts that we want to parse. We may add more ids here if we decide to render more instruments parts.\n    let trackIDsToParse: string[] = [];\n\n    let instrumentId = pianoPartId !== undefined ? pianoPartId : 'P1';\n    trackIDsToParse.push(instrumentId);\n    if (lyricsPartId !== undefined && !trackIDsToParse.includes(lyricsPartId)) {\n        trackIDsToParse.push(lyricsPartId);\n    }\n\n    xml.measures.forEach((measure, measureNumber) => {\n        trackIDsToParse.forEach(partName => {\n            if (measure.parts[partName] === undefined) return; // if part has not started yet, skip this measure.\n\n            if (parts[partName] === undefined) {\n                parts[partName] = {\n                    divisions: undefined!,\n                    progress: 0,\n                    timeSignatures: [],\n                    keySignatures: [],\n                    measures: Array(xml.measures.length).fill([]),\n                    directions: Array(xml.measures.length).fill([])\n                };\n            }\n            let part = parts[partName];\n            let notes: Note[] = [];\n            let directions: Direction[] = [];\n            // computes note lengh with respect to the beat type\n            let divisionsToNoteLength = (divisions: number) => {\n                if (part.divisions === undefined) {\n                    console.error('A note was defined before timing information was established');\n                    return divisions / 24;\n                }\n                return divisions / part.divisions * (currentBeatType / 4);\n            };\n            part.progress = 0;\n            let measureEnd = 0;\n\n            measure.parts[partName].forEach(entry => {\n                switch (entry._class) {\n                    case 'Note':\n                        if (entry.duration !== undefined) { //grace notes do not have a duration - are not displayed\n                            let time = part.progress;\n\n                            measureEnd = Math.max(measureEnd, time + divisionsToNoteLength(entry.duration));\n                            if (entry.chord !== undefined) {\n                                if (notes.length === 0) {\n                                    console.error('The first note within a measure was marked as being part of a chord');\n                                } else {\n                                    if (notes[notes.length - 1].duration !== divisionsToNoteLength(entry.duration)) {\n                                        console.error('Two notes in a chord were of different durations');\n                                    }\n                                    time = notes[notes.length - 1].time;\n                                }\n                            } else {\n                                part.progress += divisionsToNoteLength(entry.duration);\n                            }\n                            if (entry.rest === undefined && entry.pitch === undefined) {\n                                console.error('A note was neither marked as a rest or given a pitch');\n                            }\n                            if (entry.rest !== undefined && entry.pitch !== undefined) {\n                                console.error('A note was marked as a rest but was also given a pitch');\n                            }\n\n                            if (entry.pitch !== undefined) {\n                                let entryTies = entry.ties as {type: number}[];\n                                let staffNumber = entry.staff ? entry.staff : 1;\n                                let entrySlur: Slur | undefined;\n                                let entryFingering = '';\n                                let lyricsText: string | undefined;\n\n                                if (entry.notations && entry.notations.length > 0) {\n                                    entry.notations.forEach((notation: any) => {\n                                        if (notation.slurs) {\n                                            notation.slurs.forEach((slur: any) => {\n                                                if (slur.type === 0) entrySlur = 'start';\n                                                if (slur.type === 1) entrySlur = 'end';\n                                            });\n                                        }\n                                        if (notation.technicals) {\n                                            notation.technicals.forEach((technical: any) => {\n                                                console.log(technical.fingering);\n                                                if (technical.fingering) {\n                                                    if (technical.fingering.finger > -1) {\n                                                        entryFingering = `${technical.fingering.finger}`;\n                                                    }\n                                                }\n                                            });\n                                        }\n                                    });\n                                }\n                                if (entry.lyrics) {\n                                    let lyrics = entry.lyrics[0].lyricParts.find((lyrics: any) => lyrics._class === 'Text');\n                                    if (lyrics) lyricsText = lyrics.data;\n                                }\n                                let setFingering = (value: number)=>{\n                                    if(!entry.notations){\n                                        entry.notations = [];\n                                    }\n                                    if((entry.notations as any[]).every(x=>x.technicals===undefined)){\n                                        entry.notations.push({technicals: []});\n                                    }\n                                    let technicals = (entry.notations as any[]).filter(x=>x.technicals!==undefined)[0].technicals as any[];\n                                    if(technicals.every(x=>x.fingering===undefined)){\n                                        technicals.push({fingering: {\n                                            substitution: false,\n                                            fontWeight: 0,\n                                            fontStyle: 0,\n                                            color: \"#000000\",\n                                            placement: 0,\n                                            alternate: false,\n                                        }});\n                                    }\n                                    technicals.filter(x=>x.fingering!==undefined)[0].fingering.finger = value;\n                                    (xml as any).revision = Math.random();\n                                }\n                                notes.push({\n                                    time, duration: divisionsToNoteLength(entry.duration),\n                                    midi: pitchToMidi(entry.pitch),\n                                    fingering: entryFingering,\n                                    setFingering,\n                                    staff: staffNumber === 1 ? 'treble' : 'bass',\n                                    attributes: {\n                                        tie: entryTies ? (entryTies.some(tie => tie.type === 0) ? 'start' : 'end') : undefined,\n                                        slur: entrySlur,\n                                        lyrics: lyricsText\n                                    }\n                                });\n                            }\n                        }\n                        break;\n                    case 'Backup':\n                        part.progress -= divisionsToNoteLength(entry.duration);\n                        break;\n                    case 'Forward':\n                        part.progress += divisionsToNoteLength(entry.duration);\n                        break;\n                    case 'Attributes':\n                        if (entry.divisions !== undefined) {\n                            part.divisions = entry.divisions;\n                        }\n                        if (entry.times !== undefined) {\n                            if (entry.times.length !== 0) {\n                                try {\n                                    part.timeSignatures.push({\n                                        measure: measureNumber,\n                                        beats: parseInt(entry.times[0].beats[0]),\n                                        beatTypes: entry.times[0].beatTypes[0],\n                                    });\n                                    currentBeatType = entry.times[0].beatTypes[0];\n                                    currentBeats = entry.times[0].beats[0];\n                                } catch (e) {\n                                    console.error('Failed to parse time signature', entry.times[0]);\n                                }\n                            }\n                        }\n                        if (entry.keySignatures && entry.keySignatures.length !== 0) {\n                            try {\n                                part.keySignatures.push({\n                                    measure: measureNumber,\n                                    fifths: entry.keySignatures[0].fifths\n                                });\n                            } catch (e) {\n                                console.error('Failed to parse key signature', entry.keySignatures[0]);\n                            }\n                        }\n                        break;\n                    case 'Print':\n                        break;\n                    case 'Barline':\n                        break;\n                    case 'Direction':\n                        // parse tempo\n                        if (entry.hasOwnProperty('sound') && entry.sound.tempo !== undefined) {\n                            if (!tempo && entry.sound.tempo) tempo = parseInt(entry.sound.tempo); // take the first defined tempo\n                        }\n                        if (!entry.directionTypes || entry.directionTypes === 0) break;\n\n                        // parse other directions\n                        entry.directionTypes.forEach((direction: any) => {\n                            // parse dynamics\n                            if (direction.hasOwnProperty('dynamics')) {\n                                Object.keys(direction.dynamics).forEach(key => {\n                                    if (isDynamics(key)) directions.push({time: part.progress, dynamics: key});\n                                });\n                            }\n\n                            // parse wedge (crescendo / diminuendo)\n                            if (direction.hasOwnProperty('wedge')) {\n                                if (direction.wedge.type === 0) directions.push({time: part.progress, wedge: 'crescendo'});\n                                else if (direction.wedge.type === 1) directions.push({time: part.progress, wedge: 'diminuendo'});\n                                else if (direction.wedge.type === 2) directions.push({time: part.progress, wedge: 'stop'});\n                            }\n\n                            // parse pedal\n                            if (direction.hasOwnProperty('pedal')) {\n                                if (direction.pedal.type === 0) directions.push({time: part.progress, pedal: 'start'});\n                                else if (direction.pedal.type === 1) directions.push({time: part.progress, pedal: 'end'});\n                                // we disregard other pedal types\n                            }\n                        });\n                        break;\n                    case 'Sound':\n                        if (!tempo && entry.tempo) tempo = parseInt(entry.tempo); // take the first defined tempo\n                        break;\n                    default:\n                        console.error(`Unrecognized MusicXML entry: '${entry._class}'`);\n                        break;\n                }\n            });\n            part.measures[measureNumber] = notes;\n            part.directions[measureNumber] = directions;\n\n            // check pick up measure\n            if (measureNumber === 0 && measureEnd < currentBeats) {\n                let offset = currentBeats - measureEnd;\n                part.measures[0].forEach(note => note.time += offset);\n                part.directions[0].forEach(direction => direction.time += offset);\n            }\n        });\n    });\n    let tracks: Tracks = Object.keys(parts).map(partId => {\n        let trackTypes: TrackType[] = [];\n        if (partId === lyricsPartId) trackTypes.push('lyrics');\n        if (partId === instrumentId) trackTypes.push('instrument');\n\n        let trackHasBassStaffOnly = (xml: MusicXML.ScoreTimewise, partId: string) => {\n            // TODO: optimize this\n            let trackHasBassStaff = xml.measures.some(measure => {\n                return measure.parts[partId].some(entry => {\n                    return entry.clefs && entry.clefs.some((clef: any) => {\n                        return clef.sign === 'F' && clef.line === 4;\n                    });\n                });\n            });\n            let trackHasOneStaff = xml.measures.every(measure => {\n                return measure.parts[partId].every(entry => {\n                    return entry.staff === undefined;\n                });\n            });\n            return trackHasBassStaff && trackHasOneStaff;\n        };\n\n        return {\n            measures: parts[partId].measures,\n            directions: parts[partId].directions,\n            timeSignatures: parts[partId].timeSignatures,\n            keySignatures: parts[partId].keySignatures,\n            trackTypes,\n            bassStaffOnly: trackHasBassStaffOnly(xml, partId)\n        } as Track;\n    });\n\n    // handle unprovided signatures\n    tracks.forEach(track => {\n        // add default values for key signatures if it is not provided.\n        if (track.keySignatures.length === 0) track.keySignatures.push({measure: 0, fifths: 0});\n\n        if (track.timeSignatures.length === 0) {\n            if (track.measures.length === 1) {\n                // case 1: all notes grouped into a single measure\n                let measure = track.measures[0];\n                let newMeasures: Note[][] = Array(Math.ceil(measure.length / 4)).fill([]).map((_, index) => index * 4).map(start => measure.slice(start, start + 4)); // divide notes into chunks of four\n                newMeasures.forEach((measure, idx) => measure.forEach(note => note.time -= 4 * idx)); // shift note start time appropriately\n                track.timeSignatures.push({measure: newMeasures.length, beats: 4, beatTypes: 4});\n                track.measures = newMeasures;\n            } else {\n                // case 2: time signature is not provided at all\n                let currentMeasureLength = 4; // start with assuming 4/4 time signature.\n                track.measures.forEach((measure, measureNumber) => {\n                    let lastNote = measure[measure.length - 1];\n                    let measureLength = Math.max(lastNote.time + lastNote.duration);\n                    if (currentMeasureLength !== measureLength) {\n                        track.timeSignatures.push({measure: measureNumber, beats: measureLength, beatTypes: 4});\n                        currentMeasureLength = measureLength;\n                    }\n                });\n            }\n        }\n    });\n    return {tracks, tempo};\n};"],"sourceRoot":""}